<!doctype html>
<html lang="en">

<head>
<title>NTKEAPI_X.H</title>
<link rel="stylesheet" type="text/css" href="../../../../../../_styles/master.css">
<link rel="stylesheet" type="text/css" href="../../../../../../_styles/document.css">
<link rel="stylesheet" type="text/css" href="../../../_styles/km.css">
<script type="text/javascript" src="../../../../../../_scripts/master.js"></script>
<script type="text/javascript" src="../../../../../../_scripts/document.js"></script>
<script type="text/javascript" src="../../../_scripts/km.js" defer></script>
</head>

<body>

<!--webbot bot="Include" U-Include="../../../_include/noscript.htm" TAG="BODY" startspan -->

<div class="NoScript" id="Banner">
  <div id="Links">
    <ul class="LinkList">
      <li> 
      <ul class="PreferNoWrap">
        <li class="LinkListItem"><a href="../../../../../../index.htm">Home</a> </li><!--
     --><li class="LinkListItem"><a target="_self" href="../../../toc.htm">Table of Contents</a> </li><!--
     --><li class="LinkListItem"><a href="../../../../../../about/index.htm">About This Site</a> </li>
      </ul>
      <ul class="PreferNoWrap">
        <li class="LinkListItem"><a href="../../../../../../new/index.htm">What’s New?</a> </li><!--
     --><li class="LinkListItem"><a href="../../../../../../feedback/index.htm">Feedback</a> </li><!--
     --><li class="LinkListItem"><a href="../../../../../../consult/index.htm">Consult</a> </li>
      </ul>
      </li>
    </ul>
  </div>
  <div id="Logo">
    <p><span class="PreferNoWrap">Geoff Chappell -</span> <span class="PreferNoWrap">Software Analyst</span> </p>
  </div>
</div>

<!--webbot bot="Include" endspan i-checksum="43332" -->
<div class="Main">
  <h1>NTKEAPI_X.H </h1>
  <p>The public symbol files NTKRPAMP.PDB and NTKRNLMP.PDB for the original release 
  of Windows 10 tell that the kernel is built with the NTKEAPI_X.H header at </p>
  <blockquote>
    d:\th.public.fre\internal\sdk\inc
  </blockquote>
  <p>and draws from it the type definitions that are tabulated below. </p>
  <p>No header named NTKEAPI_X.H is known in any Device Driver Kit (DDK) or Windows 
  Driver Kit (WDK), but all ten types that the kernel is known to pick up from NTKEAPI_X.H 
  are also defined in WDM.H, i.e., the standard header for kernel-mode programming. 
  Five are also defined in WINNT.H, which is the standard header for user-mode programming.
  </p>
  <h2>User-Defined Types </h2>
  <p>Line numbers in the left column are from the unseen NTKEAPI_X.H for the original 
  Windows 10. They are known from the kernel’s public symbols, except that two in 
  parentheses are from other symbol files in the downloadable package of public 
  symbols. Line numbers on the right are from the indicated headers which are readily 
  available in the WDK and Software Development Kit (SDK), again for the original 
  Windows 10. </p>
  <table class="LineNumbers">
    <colgroup>
      <col class="LineNumber"><col class="Name">
      <col class="LineNumber" span="2">
    </colgroup>
    <thead>
      <tr>
        <th>Line Number </th>
        <th>Type </th>
        <th>WDM.H </th>
        <th>WINNT.H </th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td>47 </td>
        <td>struct <span class="struct">_KSYSTEM_TIME</span> </td>
        <td>259 </td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>124 </td>
        <td>enum <span class="enum">
        <a href="../../inc/api/ntkeapi_x/kspin_lock_queue_number.htm">_KSPIN_LOCK_QUEUE_NUMBER</a></span>
        </td>
        <td>334 </td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>147 </td>
        <td>struct <span class="struct">_KSPIN_LOCK_QUEUE</span> </td>
        <td>357 </td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>152 </td>
        <td>struct <span class="struct">_KLOCK_QUEUE_HANDLE</span> </td>
        <td>362 </td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>178 </td>
        <td>enum <span class="enum">
        <a href="../../inc/api/ntkeapi_x/kprofile_source.htm">_KPROFILE_SOURCE</a></span>
        </td>
        <td>370 </td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>214 </td>
        <td>struct <span class="struct">_M128A</span> </td>
        <td>404 </td>
        <td>2355 </td>
      </tr>
      <tr>
        <td>223 </td>
        <td>struct <span class="struct">_XSAVE_FORMAT</span> </td>
        <td>413 </td>
        <td>2364 </td>
      </tr>
      <tr>
        <td>255 </td>
        <td>struct <span class="struct">_XSAVE_AREA_HEADER</span> </td>
        <td>445 </td>
        <td>2396 </td>
      </tr>
      <tr>
        <td>261 </td>
        <td>struct <span class="struct">_XSAVE_AREA</span> </td>
        <td>451 </td>
        <td>2402 </td>
      </tr>
      <tr>
        <td>266 </td>
        <td>struct <span class="struct">_XSTATE_CONTEXT</span> </td>
        <td>456 </td>
        <td>2407 </td>
      </tr>
      <tr>
        <td>(296) </td>
        <td>struct <span class="struct">_CONTEXT_CHUNK</span> </td>
        <td>&nbsp;</td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>(326) </td>
        <td>struct <span class="struct">_CONTEXT_EX</span> </td>
        <td>&nbsp;</td>
        <td>&nbsp;</td>
      </tr>
    </tbody>
  </table>
  <p>It is not known whether NTKEAPI_X.H is the source of definitions in WDM.H and 
  WINNT.H or whether all pick them up from some other input, but the former inference 
  is the simpler. Whatever the means of construction, WDM.H occasionally loses lines:
  </p>
  <ul>
    <li>two between <span class="struct">KSYSTEM_TIME</span> and
    <span class="enum">KSPIN_LOCK_QUEUE_NUMBER</span>; </li>
    <li>18 between <span class="struct">KLOCK_QUEUE_HANDLE</span> and
    <span class="enum">KPROFILE_SOURCE</span>; </li>
    <li>two between <span class="enum">KPROFILE_SOURCE</span> and
    <span class="struct">M128A</span>; </li>
  </ul>
  <p>What’s lost, let alone whether it’s important, is not easily assessed without 
  an NTKEAPI_X.H for inspection. Still, out of perhaps not four hundred lines for 
  the unseen NTKEAPI_X.H, more than two hundred are published in the other headers. 
  For the two structures that do not show in these headers, usable C-language definitions 
  can be built from type information in symbol files—but, even better, old definitions 
  by Microsoft (with surprisingly extensive commenting) were published in the WDM.H 
  and WINNT.H from the WDK for Windows 7, and plausibly have not changed since. 
  From these old headers, it might also be inferred that most of what’s missing 
  between <span class="struct">KLOCK_QUEUE_HANDLE</span> and <span class="enum">
  KPROFILE_SOURCE</span> is a type definition of a <span class="type">KINTERRUPT_ROUTINE</span>. 
  A workable reconstruction of NTKEAPI_X.H from public inputs could be made with 
  good confidence. </p>
  <h3>Completeness </h3>
  <p>The table above is thought to be complete as a list of classes, enumerations 
  and structures that are defined in the unseen NTKEAPI_X.H. The supporting evidence 
  is not from public symbols but from a statically linked library named CLFSMGMT.LIB 
  which Microsoft publishes with the Software Development Kit (SDK) for Windows 
  10. Among its archived object files is a by-product of creating a pre-compiled 
  header. What it has for type information is therefore not confined to types that 
  were as used when compiling a source file for merging type information into public 
  symbols. Nor is it confined even to types that counted as used for private symbols 
  when compiling source files that contribute to a binary. The point to a pre-compiled 
  header is to cover all types that might get used for any number of compilations 
  that might yet be done. The library shows all the types that are tabulated above 
  and no others. </p>
  <h2>Anti-Trust Settlement Forensics </h2>
  <p>For the record, one of the symbol files that have type information for the 
  two structures that do not show in any published header is URLMON.PDB. Starting 
  with Windows 8, the URLMON.PDB in downloadable packages of public symbols is a 
  private symbol file. The corresponding binary is URLMON.DLL from Internet Explorer. 
  It was first presented as a component of Internet Explorer and its version numbering 
  still follows that of Internet Explorer. The disclosure may have been an oversight—it 
  was corrected for the 1803 release of Windows 10—but among its side-effects is 
  proof that, if only during this period after Microsoft’s settlement of an anti-trust 
  suit, source code for this component of Internet Explorer had the use of this 
  header, NTKEAPI_X.H, that Microsoft does not publish even for kernel-mode programming 
  outside Microsoft, let alone for the programming of a competing web browser.
  </p>
  <div class="Footer">
    <p class="Dates">This page was created on 26th
    <a href="../../../../../../new/20/10.htm">October 2020</a> and was last modified 
    on 28th <a href="../../../../../../new/23/02.htm">February 2023</a>. </p>
    <!--webbot bot="Include" U-Include="../../../_include/c2023.htm" TAG="BODY" startspan -->

<p class="Copyright">Copyright © 2020-2023. Geoff Chappell. All rights reserved. 
<a href="../../../../../../about/terms.htm">Conditions apply</a>. </p>

<!--webbot bot="Include" endspan i-checksum="54423" -->
  </div>
</div>

</body>

</html>
