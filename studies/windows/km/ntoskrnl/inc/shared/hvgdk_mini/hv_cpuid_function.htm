<!doctype html>
<html lang="en">

<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<title>HV_CPUID_FUNCTION</title>
<link rel="stylesheet" type="text/css" href="../../../../../../../_styles/master.css">
<link rel="stylesheet" type="text/css" href="../../../../../../../_styles/document.css">
<link rel="stylesheet" type="text/css" href="../../../../_styles/km.css">
<script type="text/javascript" src="../../../../../../../_scripts/master.js"></script>
<script type="text/javascript" src="../../../../../../../_scripts/document.js"></script>
<script type="text/javascript" src="../../../../_scripts/km.js" defer></script>
</head>

<body>

<!--webbot bot="Include" U-Include="../../../../_include/noscript.htm" TAG="BODY" startspan -->

<div class="NoScript" id="Banner">
  <div id="Links">
    <ul class="LinkList">
      <li> 
      <ul class="PreferNoWrap">
        <li class="LinkListItem"><a href="../../../../../../../index.htm">Home</a> </li><!--
     --><li class="LinkListItem"><a target="_self" href="../../../../toc.htm">Table of Contents</a> </li><!--
     --><li class="LinkListItem"><a href="../../../../../../../about/index.htm">About This Site</a> </li>
      </ul>
      <ul class="PreferNoWrap">
        <li class="LinkListItem"><a href="../../../../../../../new/index.htm">What’s New?</a> </li><!--
     --><li class="LinkListItem"><a href="../../../../../../../feedback/index.htm">Feedback</a> </li><!--
     --><li class="LinkListItem"><a href="../../../../../../../consult/index.htm">Consult</a> </li>
      </ul>
      </li>
    </ul>
  </div>
  <div id="Logo">
    <p><span class="PreferNoWrap">Geoff Chappell -</span> <span class="PreferNoWrap">Software Analyst</span> </p>
  </div>
</div>

<!--webbot bot="Include" endspan i-checksum="48540" -->
<div class="Main">
  <h1>HV_CPUID_FUNCTION </h1>
  <p>The <span class="enum">HV_CPUID_FUNCTION</span> enumeration (formally
  <span class="enum">_HV_CPUID_FUNCTION</span>) is Microsoft’s collection of names 
  for <span class="instruction"><a href="../../../../cpu/cpuid/index.htm">cpuid</a></span> 
  leaves that are meaningful to the Windows kernel’s support of a Microsoft-compatible 
  hypervisor. </p>
  <h2>Documentation Status </h2>
  <p>The <span class="enum">HV_CPUID_FUNCTION</span> enumeration is documented in 
  the Windows Driver Kit (WDK) for Windows 7, which was the last to have documentation 
  included. This kit also provides a C-language definition in the HVGDK.H header 
  file. Except that documentation continued to a separately downloadable package 
  for merging into Visual Studio 2012, later kits have neither the documentation 
  nor the header. </p>
  <p>If the <span class="enum">HV_CPUID_FUNCTION</span> has become undocumented, 
  it may be that Microsoft regards the enumeration as no more than a convenience 
  for Microsoft’s own programming in the loader and kernel, if not in the hypervisor 
  itself. The <span class="enum">HV_CPUID_FUNCTION</span> just repackages material 
  that Microsoft documents elsewhere. </p>
  <p>The obvious, if not the only, candidate for elsewhere is the
  <a href="https://msdn.microsoft.com/en-us/virtualization/hyperv_on_windows/reference/tlfs">
  Hypervisor Top-Level Functional Specification</a> (TLFS) which today, 12th November 
  2016, offers as its most recent version a PDF that is three years old. It, version 
  4.0b, extends no further than <span class="instruction">cpuid</span> leaf 0x40000006 
  and thus misses the leaves that are newly recognised by the Windows 10 kernels 
  from 2015. These leaves, up to and including 0x4000000A, are documented in version 
  5.0a, dated February 2017, nearing two years after Windows 10 was released as 
  the world’s must-have new Windows. Better late than never, perhaps, but the reality 
  behind the superficially fine words of the Microsoft Open Specification Promise 
  is that the Hyper-V implementation, and presumably Microsoft’s use of it to Microsoft’s 
  advantage for Microsoft’s purposes, runs years ahead of the documentation that 
  Microsoft opens for general use. </p>
  <p>As for the <span class="enum">HV_CPUID_FUNCTION</span> as Microsoft’s particular 
  naming of <span class="instruction">cpuid</span> leaves, disclosure after the 
  WDK for Windows 7 is conspicuously thin. The practical equivalent of a C-language 
  definition is published as type information in symbol files, but in the downloadable 
  packages of public symbols for 32-bit and 64-bit Windows 10, type information 
  for <span class="enum">HV_CPUID_FUNCTION</span> appears <span class="emphasis">
  only</span> in the symbol files for URLMON.DLL. This is a user-mode DLL that originated 
  as a component of Internet Explorer (and still follows Internet Explorer’s version 
  numbering). Well might you wonder what this DLL has to do with the hypervisor 
  such that its symbol files have type information for this structure but the kernel’s 
  don’t! Symbol files for URLMON.DLL starting with Windows 8, both in packages of 
  Windows symbols and when downloaded from Microsoft’s public symbol server, happen 
  to be private symbols. This surely was an oversight, but however this disclosure 
  came about, Microsoft stopped it for Version 1803. That URLMON.DLL knows of the
  <span class="enum">HV_CPUID_FUNCTION</span> is because some URLMON.DLL source 
  code has a <span class="directive">#include</span> for a header named
  <a href="../../../source/inc/hvgdk_mini.htm">hvgdk_mini.h</a>. Microsoft is known 
  to use his header for its own programming of the Windows kernel but is not known 
  to have ever made it available for use by programmers in general (let alone by 
  the programmers of competing web browsers). </p>
  <p>Type information for the <span class="enum">HV_CPUID_FUNCTION</span> also turns 
  out to have been hiding in the relatively plain sight of a statically linked library 
  named CLFSMGMT.LIB which is among the many that are supplied with the Software 
  Development Kit (SDK) for user-mode programming. Type information in this library 
  has the special value of confirming that the <span class="enum">HV_CPUID_FUNCTION</span> 
  was defined as long ago as Windows Vista, i.e., before Microsoft published HVGDK.H 
  for Windows 7. Against this is that type information for this enumeration is not 
  in all versions of the library. It doesn’t start in the 64-bit library until WIndows 
  8 and it drops out for both 32-bit and 64-bit in Version 2004. Beware anyway that 
  type information in statically linked libraries has less forensic value (than 
  in the operating system’s symbol files) because it does not always match the operating 
  system that the library is supposedly intended for. </p>
  <h2>Values </h2>
  <p>Microsoft’s names for the <span class="enum">HV_CPUID_FUNCTION</span> enumeration 
  and its members are known from (in roughly decreasing order of forensic quality): 
  the C-language definition in the WDK for Windows 7; type information in symbol 
  files for the kernel in Windows 8.1 (only) and for URLMON.DLL in Windows 8 through 
  to the 1709 release of Windows 10; and type information in most versions of CLFSMGMT.LIB 
  for Windows Vista through to the 1903 release of Windows 10. I know of no public 
  source beyond Version 1903. </p>
  <table class="Enum">
    <colgroup>
      <col class="Value"><col class="Name"><col class="Versions">
    </colgroup>
    <thead>
      <tr>
        <th>Value </th>
        <th>Name </th>
        <th>Versions </th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td>0x00000001 </td>
        <td><span class="constant">HvCpuIdFunctionVersionAndFeatures</span> </td>
        <td>6.0 and higher </td>
      </tr>
      <tr>
        <td>0x40000000 </td>
        <td><span class="constant">HvCpuIdFunctionHvVendorAndMaxFunction</span>
        </td>
        <td>6.0 and higher </td>
      </tr>
      <tr>
        <td>0x40000001 </td>
        <td><span class="constant">HvCpuIdFunctionHvInterface</span> </td>
        <td>6.0 and higher </td>
      </tr>
      <tr>
        <td>0x40000002 </td>
        <td><span class="constant">HvCpuIdFunctionMsHvVersion</span> </td>
        <td>6.0 and higher </td>
      </tr>
      <tr>
        <td>0x40000003 </td>
        <td><span class="constant">HvCpuIdFunctionMsHvFeatures</span> </td>
        <td>6.0 and higher </td>
      </tr>
      <tr>
        <td>0x40000004 </td>
        <td><span class="constant">HvCpuIdFunctionMsHvEnlightenmentInformation</span>
        </td>
        <td>6.0 and higher </td>
      </tr>
      <tr>
        <td>0x40000005 </td>
        <td><span class="constant">HvCpuIdFunctionMsHvImplementationLimits</span>
        </td>
        <td>6.0 and higher </td>
      </tr>
      <tr>
        <td>0x40000006 </td>
        <td><span class="constant">HvCpuIdFunctionMsHvHardwareFeatures</span>
        </td>
        <td>6.2 and higher </td>
      </tr>
      <tr>
        <td>0x40000007 </td>
        <td><span class="constant">HvCpuIdFunctionMsHvCpuManagementFeatures</span>
        </td>
        <td>10.0 and higher </td>
      </tr>
      <tr>
        <td>0x40000008 </td>
        <td><span class="constant">HvCpuIdFunctionMsHvSvmFeatures</span> </td>
        <td>10.0 and higher </td>
      </tr>
      <tr>
        <td>0x40000009 </td>
        <td><span class="constant">HvCpuIdFunctionMsHvSkipLevelFeatures</span>
        </td>
        <td>1511 and higher </td>
      </tr>
      <tr>
        <td>0x4000000A </td>
        <td><span class="constant">HvCpuidFunctionMsHvNestedVirtFeatures</span>
        </td>
        <td>1511 and higher </td>
      </tr>
      <tr>
        <td>0x4000000B </td>
        <td><span class="constant">HvCpuidFunctionMsHvIptFeatures</span> </td>
        <td>1903 and higher </td>
      </tr>
      <tr>
        <td>0x40000005 (6.1); <br>
        0x40000006 (6.2 to 6.3); <br>
        0x40000008 (10.0); <br>
        0x4000000A (1511 to 1809); <br>
        0x4000000B </td>
        <td><span class="constant">HvCpuIdFunctionMaxReserved</span> </td>
        <td>6.1 and higher </td>
      </tr>
    </tbody>
  </table>
  <p>Note that the members’ names differentiate <span class="instruction">cpuid</span> 
  leaves 0x40000000 and 0x40000001 as generic to any hypervisor (“Hv”), and subsequent 
  leaves as particular to Microsoft hypervisors (“MsHv”). </p>
  <p>Type information in CLFSMGMT.LIB does not show <span class="constant">HvCpuIdFunctionMaxReserved</span> 
  until the version from the Windows 8 SDK, no matter that the published HVGDK.H 
  shows it for Windows 7. It may have been defined only shortly before the final 
  build for Windows 7: the library in the Windows 7 SDK was built a month before 
  the Windows 7 kernel (11th June 2009 versus 14th July). </p>
  <h3>Documentation Status Details </h3>
  <p>Symbol files for Windows 8 have the enumeration extend to
  <span class="constant">HvCpuIdFunctionMsHvHardwareFeatures</span>. The TLFS from 
  the time, version 2.0a dated May 2012, also ends with
  <span class="instruction">cpuid</span> leaf 0x40000006. The roughly contemporaneous 
  WDK documentation to merge into Visual Studio 2012 had not caught up: its page 
  for <span class="enum">HV_CPUID_FUNCTION</span> is dated “7/19/2012” but reaches 
  only to <span class="constant">HvCpuIdFunctionMsHvImplementationLimits</span> 
  (0x40000005), just as did the corresponding page in the WDK for Windows 7 from 
  “June 18, 2009”. </p>
  <p>The kernel is known to use <span class="instruction">cpuid</span> leaf 0x4000000B 
  in the first of the half-yearly updates for 2019 and Microsoft’s name for this 
  leaf is in CLFSMGMT.LIB from the Windows SDK as distributed with the Enterprise 
  WDK for Version 1903. Nearly a year later this use is not covered by the TLFS 
  version 6.0b, dated February 2020. </p>
  <div class="Footer">
    <p class="Dates">This page was created on 14th
    <a href="../../../../../../../new/22/10.htm">November 2022</a> from material 
    first published on 12th <a href="../../../../../../../new/16/11.htm">November 
    2016</a>. It was last modified on 10th December 2022. </p>
    <!--webbot bot="Include" U-Include="../../../../_include/c1622.htm" TAG="BODY" startspan -->

<p class="Copyright">Copyright © 2016-2022. Geoff Chappell. All rights reserved. 
<a href="../../../../../../../about/terms.htm">Conditions apply</a>. </p>

<!--webbot bot="Include" endspan i-checksum="4925" -->
  </div>
</div>

</body>

</html>
