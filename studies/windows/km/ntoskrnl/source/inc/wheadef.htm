<!doctype html>
<html lang="en">

<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<title>WHEADEF.H</title>
<link rel="stylesheet" type="text/css" href="../../../../../../_styles/master.css">
<link rel="stylesheet" type="text/css" href="../../../../../../_styles/document.css">
<link rel="stylesheet" type="text/css" href="../../../_styles/km.css">
<script type="text/javascript" src="../../../../../../_scripts/master.js"></script>
<script type="text/javascript" src="../../../../../../_scripts/document.js"></script>
<script type="text/javascript" src="../../../_scripts/km.js" defer></script>
</head>

<body>

<!--webbot bot="Include" U-Include="../../../_include/noscript.htm" TAG="BODY" startspan -->

<div class="NoScript" id="Banner">
  <div id="Links">
    <ul class="LinkList">
      <li> 
      <ul class="PreferNoWrap">
        <li class="LinkListItem"><a href="../../../../../../index.htm">Home</a> </li><!--
     --><li class="LinkListItem"><a target="_self" href="../../../toc.htm">Table of Contents</a> </li><!--
     --><li class="LinkListItem"><a href="../../../../../../about/index.htm">About This Site</a> </li>
      </ul>
      <ul class="PreferNoWrap">
        <li class="LinkListItem"><a href="../../../../../../new/index.htm">What’s New?</a> </li><!--
     --><li class="LinkListItem"><a href="../../../../../../feedback/index.htm">Feedback</a> </li><!--
     --><li class="LinkListItem"><a href="../../../../../../consult/index.htm">Consult</a> </li>
      </ul>
      </li>
    </ul>
  </div>
  <div id="Logo">
    <p><span class="PreferNoWrap">Geoff Chappell -</span> <span class="PreferNoWrap">Software Analyst</span> </p>
  </div>
</div>

<!--webbot bot="Include" endspan i-checksum="43332" -->
<div class="Main">
  <h1>WHEADEF.H </h1>
  <p>The public symbol files NTKRPAMP.PDB and NTKRNLMP.PDB for the original release 
  of Windows 10 tell that the kernel is built with the WHEADEF.H header at </p>
  <blockquote>
    d:\th.public.fre\sdk\inc
  </blockquote>
  <p>and draws from it the type definitions that are tabulated below. </p>
  <p>Nowadays, WHEADEF.H is among the headers in the Software Development Kit (SDK) 
  for Windows 10. It is there in the “um” subdirectory with many other headers that 
  are intended only for user-mode programming. It dates from Windows 7, again in 
  the SDK. WHEADEF.H seems never to have been supplied with a Windows Driver Kit 
  (WDK) except in bundles with the SDK. All its significant content is anyway duplicated 
  in NTDDK.H and in NTOSP.H, but no sign is known of how this happens. </p>
  <p>NTDDK.H is, of course, a standard header for kernel-mode programming, and NTOSP.H 
  is similar but for Microsoft’s private use (notwithstanding its disclosure in 
  two early editions of the WDK for Windows 10). The kernel’s own source code does 
  not <span class="directive">#include</span> either NTDDK.H or NTOSP.H. The definitions 
  that these headers share with WHEADEF.H are in the kernel from including WHEADEF.H. 
  Whether the kernel includes WHEADEF.H directly or through some other header is 
  not known. </p>
  <p>In the table, the line numbers on the left are from WHEADEF.H, both as known 
  from the symbol file and from the header as supplied with the SDK for the original 
  release of Windows 10. The line numbers on the right are from the NTDDK.H and 
  NTOSP.H in the contemporaneous WDK. </p>
  <table class="LineNumbers">
    <colgroup>
      <col class="LineNumber"><col class="Name">
      <col class="LineNumber" span="2">
    </colgroup>
    <thead>
      <tr>
        <th>Line Number </th>
        <th>Type </th>
        <th>NTDDK.H </th>
        <th>NTOSP.H </th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td>36 </td>
        <td>enum <span class="enum">_WHEA_ERROR_SOURCE_TYPE</span> </td>
        <td>14160 </td>
        <td>49077 </td>
      </tr>
      <tr>
        <td>57 </td>
        <td>enum <span class="enum">_WHEA_ERROR_SOURCE_STATE</span> </td>
        <td>14181 </td>
        <td>49098 </td>
      </tr>
      <tr>
        <td>96 </td>
        <td>union <span class="union">_WHEA_NOTIFICATION_FLAGS</span> </td>
        <td>14220 </td>
        <td>49137 </td>
      </tr>
      <tr>
        <td>108 </td>
        <td>union <span class="union">_XPF_MC_BANK_FLAGS</span> </td>
        <td>14232 </td>
        <td>49149 </td>
      </tr>
      <tr>
        <td>117 </td>
        <td>union <span class="union">_XPF_MCE_FLAGS</span> </td>
        <td>14241 </td>
        <td>49158 </td>
      </tr>
      <tr>
        <td>126 </td>
        <td>union <span class="union">_AER_ROOTPORT_DESCRIPTOR_FLAGS</span> </td>
        <td>14250 </td>
        <td>49167 </td>
      </tr>
      <tr>
        <td>138 </td>
        <td>union <span class="union">_AER_ENDPOINT_DESCRIPTOR_FLAGS</span> </td>
        <td>14262 </td>
        <td>49179 </td>
      </tr>
      <tr>
        <td>149 </td>
        <td>union <span class="union">_AER_BRIDGE_DESCRIPTOR_FLAGS</span> </td>
        <td>14273 </td>
        <td>49190 </td>
      </tr>
      <tr>
        <td>168 </td>
        <td>struct <span class="struct">_WHEA_NOTIFICATION_DESCRIPTOR</span>
        </td>
        <td>14292 </td>
        <td>49209 </td>
      </tr>
      <tr>
        <td>173 </td>
        <td>unnamed union <span class="member">u</span> in <br>
        struct <span class="struct">_WHEA_NOTIFICATION_DESCRIPTOR</span> </td>
        <td>14297 </td>
        <td>49214 </td>
      </tr>
      <tr>
        <td>174 </td>
        <td>unnamed struct <span class="member">Polled</span> in <br>
        unnamed union <span class="member">u</span> in <br>
        struct <span class="struct">_WHEA_NOTIFICATION_DESCRIPTOR</span> </td>
        <td>14298 </td>
        <td>49215 </td>
      </tr>
      <tr>
        <td>178 </td>
        <td>unnamed struct <span class="member">Interrupt</span> in <br>
        unnamed union <span class="member">u</span> in <br>
        struct <span class="struct">_WHEA_NOTIFICATION_DESCRIPTOR</span> </td>
        <td>14302 </td>
        <td>49219 </td>
      </tr>
      <tr>
        <td>187 </td>
        <td>unnamed struct <span class="member">LocalInterrupt</span> in <br>
        unnamed union <span class="member">u</span> in <br>
        struct <span class="struct">_WHEA_NOTIFICATION_DESCRIPTOR</span> </td>
        <td>14311 </td>
        <td>49228 </td>
      </tr>
      <tr>
        <td>196 </td>
        <td>unnamed struct <span class="member">Sci</span> in <br>
        unnamed union <span class="member">u</span> in <br>
        struct <span class="struct">_WHEA_NOTIFICATION_DESCRIPTOR</span> </td>
        <td>14320 </td>
        <td>49237 </td>
      </tr>
      <tr>
        <td>205 </td>
        <td>unnamed struct <span class="member">Nmi</span> in <br>
        unnamed union <span class="member">u</span> in <br>
        struct <span class="struct">_WHEA_NOTIFICATION_DESCRIPTOR</span> </td>
        <td>14329 </td>
        <td>49246 </td>
      </tr>
      <tr>
        <td>223 </td>
        <td>struct <span class="struct">_WHEA_XPF_MC_BANK_DESCRIPTOR</span> </td>
        <td>14347 </td>
        <td>49264 </td>
      </tr>
      <tr>
        <td>241 </td>
        <td>struct <span class="struct">_WHEA_XPF_MCE_DESCRIPTOR</span> </td>
        <td>14365 </td>
        <td>49282 </td>
      </tr>
      <tr>
        <td>257 </td>
        <td>struct <span class="struct">_WHEA_XPF_CMC_DESCRIPTOR</span> </td>
        <td>14381 </td>
        <td>49298 </td>
      </tr>
      <tr>
        <td>266 </td>
        <td>struct <span class="struct">_WHEA_PCI_SLOT_NUMBER</span> </td>
        <td>14390 </td>
        <td>49307 </td>
      </tr>
      <tr>
        <td>267 </td>
        <td>unnamed union <span class="member">u</span> in <br>
        struct <span class="struct">_WHEA_PCI_SLOT_NUMBER</span> </td>
        <td>14391 </td>
        <td>49308 </td>
      </tr>
      <tr>
        <td>268 </td>
        <td>unnamed struct <span class="member">bits</span> in <br>
        unnamed union <span class="member">u</span> in <br>
        struct <span class="struct">_WHEA_PCI_SLOT_NUMBER</span> </td>
        <td>14392 </td>
        <td>49309 </td>
      </tr>
      <tr>
        <td>283 </td>
        <td>struct <span class="struct">_WHEA_XPF_NMI_DESCRIPTOR</span> </td>
        <td>14407 </td>
        <td>49324 </td>
      </tr>
      <tr>
        <td>294 </td>
        <td>struct <span class="struct">_WHEA_AER_ROOTPORT_DESCRIPTOR</span>
        </td>
        <td>14418 </td>
        <td>49335 </td>
      </tr>
      <tr>
        <td>315 </td>
        <td>struct <span class="struct">_WHEA_AER_ENDPOINT_DESCRIPTOR</span>
        </td>
        <td>14439 </td>
        <td>49356 </td>
      </tr>
      <tr>
        <td>335 </td>
        <td>struct <span class="struct">_WHEA_AER_BRIDGE_DESCRIPTOR</span> </td>
        <td>14459 </td>
        <td>49376 </td>
      </tr>
      <tr>
        <td>358 </td>
        <td>struct <span class="struct">_WHEA_GENERIC_ERROR_DESCRIPTOR</span>
        </td>
        <td>14482 </td>
        <td>49399 </td>
      </tr>
      <tr>
        <td>412 </td>
        <td>struct <span class="struct">_WHEA_IPF_MCA_DESCRIPTOR</span> </td>
        <td>14536 </td>
        <td>49453 </td>
      </tr>
      <tr>
        <td>418 </td>
        <td>struct <span class="struct">_WHEA_IPF_CMC_DESCRIPTOR</span> </td>
        <td>14542 </td>
        <td>49459 </td>
      </tr>
      <tr>
        <td>424 </td>
        <td>struct <span class="struct">_WHEA_IPF_CPE_DESCRIPTOR</span> </td>
        <td>14548 </td>
        <td>49465 </td>
      </tr>
      <tr>
        <td>430 </td>
        <td>struct <span class="struct">_WHEA_ERROR_SOURCE_DESCRIPTOR</span>
        </td>
        <td>14554 </td>
        <td>49471 </td>
      </tr>
      <tr>
        <td>442 </td>
        <td>unnamed union <span class="member">Info</span> in <br>
        struct <span class="struct">_WHEA_ERROR_SOURCE_DESCRIPTOR</span> </td>
        <td>14566 </td>
        <td>49483 </td>
      </tr>
    </tbody>
  </table>
  <p>For the record, lines 26 to 470 inclusive of the 475-line WHEADEF.H are duplicated 
  as lines 14150 to 14594 of NTDDK.H and 49067 to 49511 of NTOSP.H. All that’s omitted 
  in this duplication is the copyyright notice and abstract, all as one comment, 
  and the usual few lines at each end for guarding against repeated inclusion, and 
  a few more to include two other headers. Everything that is particular to WHEADEF.H 
  is duplicated in NTDDK.H and NTOSP.H. All the types that are defined in WHEADEF.H 
  (rather than in a header that it includes, notably <a href="cper.htm">cper.h</a>) 
  show in the kernel’s public symbols. There are no secrets here. Yet some small 
  observations may be useful. </p>
  <p>One is a possibly inconsequential difference of order: NTDDK.H and NTOSP.H 
  both reproduce first from WHEADEF.H and then from CPER.H; a
  <span class="directive">#include</span> of WHEADEF.H picks up the CPER.H definitions 
  first. </p>
  <p>Of more practical consequence when debugging the Windows Hardware Error Architecture 
  is what brings all the user-defined types from WHEADEF.H into the kernel’s public 
  symbol files. Because <span class="struct">_WHEA_ERROR_SOURCE_DESCRIPTOR</span> 
  has all the others nested within, whatever brought it into the public symbols 
  will have brought in the rest of them. But because the header itself makes no 
  use of <span class="struct">_WHEA_ERROR_SOURCE_DESCRIPTOR</span>, a
  <span class="directive">#include</span> of WHEADEF.H does not suffice. It might 
  be used explicitly in the <a href="../ntsym.htm">ntsym.c</a> source file that’s 
  compiled for merging type definitions into the public symbols, but the layout 
  of records in the public symbols suggests that the use that brings
  <span class="struct">_WHEA_ERROR_SOURCE_DESCRIPTOR</span> into the public symbols 
  is instead its nesting as the <span class="member">Descriptor</span> member of 
  the <span class="struct">_WHEAP_ERROR_SOURCE</span> that’s defined in
  <a href="wheai.htm">wheai.h</a>. Inclusion of this header apparently does suffice, 
  which is just as well, else the <span class="command">!whea</span> command as 
  implemented by the KDEXTS.DLL debugger extension would join the many others that 
  do not work well when only public symbols are available. </p>
  <div class="Footer">
    <p class="Dates">This page was created on 2nd
    <a href="../../../../../../new/20/11.htm">November 2020</a> and was last modified 
    on 12th <a href="../../../../../../new/23/02.htm">February 2023</a>. </p>
    <!--webbot bot="Include" U-Include="../../../_include/c2023.htm" TAG="BODY" startspan -->

<p class="Copyright">Copyright © 2020-2023. Geoff Chappell. All rights reserved. 
<a href="../../../../../../about/terms.htm">Conditions apply</a>. </p>

<!--webbot bot="Include" endspan i-checksum="54423" -->
  </div>
</div>

</body>

</html>
