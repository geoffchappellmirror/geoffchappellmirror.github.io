<html>

<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<title>The __LINE__ Macro</title>
<link rel="stylesheet" type="text/css" href="../../../../../../_styles/master.css">
<link rel="stylesheet" type="text/css" href="../../../../../../_styles/document.css">
<link rel="stylesheet" type="text/css" href="../../../../_styles/msvc.css">
<script type="text/javascript" src="../../../../../../_scripts/master.js"></script>
<script type="text/javascript" src="../../../../../../_scripts/document.js"></script>
<script type="text/javascript" src="../../../../_scripts/msvc.js"></script>
</head>

<body>

<!--webbot bot="Include" U-Include="../../../../_include/noscript.htm" TAG="BODY" startspan -->

<div class="NoScript" id="Banner">
  <div id="Links">
    <ul class="LinkList">
      <li class="LinkListItem"><a href="../../../../../../index.htm"><span>Home</span></a> </li>
      <li class="LinkListItem"><a target="_self" href="../../../../toc.htm"><span>Table of Contents</span></a> </li>
      <li class="LinkListItem"><a href="../../../../../../about/index.htm"><span>About This Site</span></a> </li>
      <li class="LinkListItem"><a href="../../../../../../new/index.htm"><span>What’s New?</span></a> </li>
      <li class="LinkListItem"><a href="../../../../../../feedback/index.htm"><span>Feedback</span></a> </li>
      <li class="LinkListItem"><a href="../../../../../../consult/index.htm"><span>Consult</span></a> </li>
    </ul>
  </div>
  <div id="Logo">
    <p>Geoff Chappell - Software Analyst </p>
  </div>
</div>

<!--webbot bot="Include" i-checksum="35843" endspan -->
<h1>The __LINE__ Macro </h1>
<h2>Syntax </h2>
<p>The macro is <span class="macro">__LINE__</span> only, with no argument list.
</p>
<h2>Expansion </h2>
<p>The <span class="macro">__LINE__</span> macro expands differently depending 
on where it is used. Generally speaking, it expands to the text for an integer 
constant, in decimal notation, whose value is the 1-based relative line number 
associated with whatever line contains the macro. The line number is relative to 
whatever compilation unit the line came from and is subject to renumbering via 
the
<span class="directive">#line</span> directive. </p>
<h3>The Line Number Variable </h3>
<p>Two important special cases exist, but their detailed description exceeds the 
present worth of these notes and a sketch must suffice for now. In both cases,
<span class="macro">__LINE__</span> expands not to a constant but to </p>
<pre class="source">(__LINE__Var+<span class="placeholder">constant</span>)</pre>
<p>The identifier <span class="variable">__LINE__Var</span> names a variable and 
the <span class="placeholder">constant</span> is relative to whatever line 
number is held in the variable. The simplest demonstration has as necessary 
conditions that <span class="switch">/ZI</span> be active and that <span class="macro">
__LINE__</span> 
be used in a function. For a quick view of the overall effect, compile the 
fragment
</p>
<pre class="source">int x1, x2;

void func (void)
{
    x1 = __LINE__;
    x2 = __LINE__;
}</pre>
<p>with the <span class="switch">/ZI</span> option and study the 
assembly-language output to see <span class="variable">__LINE__Var</span> 
generated by the compiler as a <span class="type">long</span> in the scope of <span class="variable">
func</span>. To see the macro expansion, do the same but with some such fragment 
as </p>
<p></p>
<pre class="source">#define STRINGIZE(s)    #s
#define MACRO_TEXT(s)   STRINGIZE (s)

char *p1, *p2;

void func (void)
{
    p1 = MACRO_TEXT (__LINE__);
    p2 = MACRO_TEXT (__LINE__);
}</pre>
<p>and notice what different strings are created for the two variables. Compile 
both demonstrations with <span class="switch">/E</span>, expecting perhaps to 
see the macro expansions in the preprocessor output, and wonder if it means 
anything that Microsoft hides what’s going on. </p>
<div class="Footer">
  <p class="Dates">This page was created on 17th February 2006 and was last 
  modified on 6th January 2010. </p>
  <!--webbot bot="Include" U-Include="../../../../_include/c0610.htm" TAG="BODY" startspan -->

<p class="Copyright">Copyright © 2006-2010. Geoff Chappell. All rights reserved.
<a href="../../../../../../about/terms.htm">Conditions apply</a>. </p>

<!--webbot bot="Include" i-checksum="4055" endspan -->
</div>

</body>

</html>