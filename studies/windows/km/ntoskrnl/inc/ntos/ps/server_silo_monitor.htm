<!doctype html>
<html lang="en">

<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<title>SERVER_SILO_MONITOR</title>
<link rel="stylesheet" type="text/css" href="../../../../../../../_styles/master.css">
<link rel="stylesheet" type="text/css" href="../../../../../../../_styles/document.css">
<link rel="stylesheet" type="text/css" href="../../../../_styles/km.css">
<script type="text/javascript" src="../../../../../../../_scripts/master.js"></script>
<script type="text/javascript" src="../../../../../../../_scripts/document.js"></script>
<script type="text/javascript" src="../../../../_scripts/km.js" defer></script>
</head>

<body>

<!--webbot bot="Include" U-Include="../../../../_include/noscript.htm" TAG="BODY" startspan -->

<div class="NoScript" id="Banner">
  <div id="Links">
    <ul class="LinkList">
      <li> 
      <ul class="PreferNoWrap">
        <li class="LinkListItem"><a href="../../../../../../../index.htm">Home</a> </li><!--
     --><li class="LinkListItem"><a target="_self" href="../../../../toc.htm">Table of Contents</a> </li><!--
     --><li class="LinkListItem"><a href="../../../../../../../about/index.htm">About This Site</a> </li>
      </ul>
      <ul class="PreferNoWrap">
        <li class="LinkListItem"><a href="../../../../../../../new/index.htm">What’s New?</a> </li><!--
     --><li class="LinkListItem"><a href="../../../../../../../feedback/index.htm">Feedback</a> </li><!--
     --><li class="LinkListItem"><a href="../../../../../../../consult/index.htm">Consult</a> </li>
      </ul>
      </li>
    </ul>
  </div>
  <div id="Logo">
    <p><span class="PreferNoWrap">Geoff Chappell -</span> <span class="PreferNoWrap">Software Analyst</span> </p>
  </div>
</div>

<!--webbot bot="Include" endspan i-checksum="48540" -->
<div class="main">
  <!--webbot bot="Include" U-Include="../../../../_include/draft.htm" TAG="BODY" startspan -->

<div class="Header">
  <p class="alert">DRAFT: Take more than your usual care. </p>
</div>

<!--webbot bot="Include" endspan i-checksum="34080" -->
  <h1>SERVER_SILO_MONITOR </h1>
  <p>The <span class="struct">SERVER_SILO_MONITOR</span> (formally
  <span class="struct">_SERVER_SILO_MONITOR</span>) represents a registered monitor 
  of server silos in the first two releases of Windows 10. A driver or other kernel-mode 
  software calls the <span class="function">PsRegisterMonitorServerSilo</span> function 
  to express its interest in what’s done with server silos. This creates a
  <span class="struct">SERVER_SILO_MONITOR</span> whose address can then be used 
  when calling several other functions. </p>
  <p>The substantial reworking of the silo implementation for Version 1607 discontinued 
  the <span class="function">PsRegisterMonitorServerSilo</span> function in favour 
  of a new <span class="function">PsRegisterSiloMonitor</span> which, among other 
  differences, creates a <span class="struct">SILO_MONITOR</span> instead. </p>
  <h2>Documentation Status </h2>
  <p>Microsoft is not known ever to have documented the <span class="struct">SERVER_SILO_MONITOR</span> 
  or to have published a C-language definition or even to have let a definition 
  slip out as type information in symbol files. </p>
  <p>Microsoft’s name for the structure is known from the NTOSP.H headers which 
  Microsoft published, possibly by oversight, in the Windows Driver Kit (WDK) for 
  the original and 1511 releases of WIndows 10. It is there defined only as an opaque 
  type. Public symbol files for the kernel in these versions also name the structure 
  in type information, but only from its declaration, not as a definition. </p>
  <h2>Variability </h2>
  <p>The <span class="struct">SERVER_SILO_MONITOR</span> likely would have been 
  highly susceptible to changing between builds had it persisted. Even during its 
  short live, it changed size when one member was removed: </p>
  <table class="Sizes">
    <colgroup>
      <col class="Version"><col class="Size" span="2">
    </colgroup>
    <thead>
      <tr>
        <th>Version </th>
        <th>Size (x86) </th>
        <th>Size (x64) </th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td>10.0 </td>
        <td>0x48 </td>
        <td>0x80 </td>
      </tr>
      <tr>
        <td>1511 </td>
        <td>0x40 </td>
        <td>0x70 </td>
      </tr>
    </tbody>
  </table>
  <h2>Layout </h2>
  <p>Microsoft’s names and types of the structure’s members are not known. Type 
  information in the public symbol files for the kernel shows only the structure’s 
  name as a declaration, not its members from a definition. </p>
  <table class="Struct">
    <colgroup>
      <col class="Offset" span="2"><col class="Definition">
      <col class="Versions">
    </colgroup>
    <thead>
      <tr>
        <th>Offset (x86) </th>
        <th>Offset (x64) </th>
        <th>Definition </th>
        <th>Versions </th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td>0x00 </td>
        <td>0x00 </td>
        <td>unknown <span class="struct">LIST_ENTRY</span> </td>
        <td>10.0 to 1511 </td>
      </tr>
      <tr>
        <td>0x08 (10.0) </td>
        <td>0x10 (10.0) </td>
        <td>unknown <span class="struct">LIST_ENTRY</span> </td>
        <td>10.0 only </td>
      </tr>
      <tr>
        <td>0x10 (10.0); <br>
        0x08 </td>
        <td>0x20 (10.0); <br>
        0x10 </td>
        <td>unknown 32-bit tag </td>
        <td>10.0 to 1511 </td>
      </tr>
      <tr>
        <td>0x14 (10.0); <br>
        0x0C </td>
        <td>0x24 (10.0); <br>
        0x14 </td>
        <td>unknown 32-bit flags </td>
        <td>10.0 to 1511 </td>
      </tr>
      <tr>
        <td>0x18 (10.0); <br>
        0x10 </td>
        <td>0x28 (10.0); <br>
        0x18 </td>
        <td>unknown 32-bit reference count </td>
        <td>10.0 to 1511 </td>
      </tr>
      <tr>
        <td>0x1C (10.0); <br>
        0x14 </td>
        <td>0x30 (10.0); <br>
        0x20 </td>
        <td>unknown <span class="struct">EX_RUNDOWN_REF</span> </td>
        <td>10.0 to 1511 </td>
      </tr>
      <tr>
        <td>0x20 (10.0); <br>
        0x18 </td>
        <td>0x38 (10.0); <br>
        0x28 </td>
        <td>
        <pre class="source">NTSTATUS 
(*CreateCallback) (
    PESILO);</pre>
        </td>
        <td>10.0 to 1511 </td>
      </tr>
      <tr>
        <td>0x24 (10.0); <br>
        0x1C </td>
        <td>0x40 (10.0); <br>
        0x30 </td>
        <td>
        <pre class="source">VOID 
(*TerminateCallback) (
    PESILO, 
    PVOID);</pre>
        </td>
        <td>10.0 to 1511 </td>
      </tr>
      <tr>
        <td>0x28 (10.0); <br>
        0x20 </td>
        <td>0x48 (10.0); <br>
        0x38 </td>
        <td>
        <pre class="source">VOID 
(*DriverLoadCallback) (
    PESILO, 
    PVOID);</pre>
        </td>
        <td>10.0 to 1511 </td>
      </tr>
      <tr>
        <td>0x2C (10.0); <br>
        0x24 </td>
        <td>0x50 (10.0); <br>
        0x40 </td>
        <td>
        <pre class="source">VOID 
(*DriverUnloadCallback) (
    PESILO, 
    PVOID);</pre>
        </td>
        <td>10.0 to 1511 </td>
      </tr>
      <tr>
        <td>0x30 (10.0); <br>
        0x28 </td>
        <td>0x58 (10.0); <br>
        0x48 </td>
        <td>
        <pre class="source">VOID 
(*ContextCleanupCallback) (
    PVOID);</pre>
        </td>
        <td>10.0 to 1511 </td>
      </tr>
      <tr>
        <td>0x34 (10.0); <br>
        0x2C </td>
        <td>0x60 (10.0); <br>
        0x50 </td>
        <td>unknown <span class="struct">UNICODE_STRING</span> </td>
        <td>10.0 to 1511 </td>
      </tr>
      <tr>
        <td>0x3C (10.0); <br>
        0x34 </td>
        <td>0x70 0x60 </td>
        <td>unknown pointer to <span class="struct">DRIVER_OBJECT</span> </td>
        <td>10.0 to 1511 </td>
      </tr>
      <tr>
        <td>0x40 (10.0); <br>
        0x38 </td>
        <td>0x78 (10.0); <br>
        0x68 </td>
        <td>unknown 32-bit index </td>
        <td>10.0 to 1511 </td>
      </tr>
      <tr>
        <td>0x44 (10.0); <br>
        0x3C </td>
        <td>0x7C (10.0); <br>
        0x6C </td>
        <td>unknown <span class="type">BOOLEAN</span> </td>
        <td>10.0 to 1511 </td>
      </tr>
      <tr>
        <td>0x45 (10.0); <br>
        0x3D (1511) </td>
        <td>0x7D (10.0); <br>
        0x6D </td>
        <td>
        <pre class="source">BOOLEAN UsePagedPoolForContexts;</pre>
        </td>
        <td>10.0 to 1511 </td>
      </tr>
    </tbody>
  </table>
  <p>For a few members, names and types are proposed above by inferring a correspondence 
  with members of another structure for which Microsoft’s names and types are known 
  with certainty. The NTOSP.H that Microsoft disclosed, possibly by oversight, in 
  the Windows Driver Kit (WDK) for both the original and 1511 releases of Windows 
  10 has a C-language definition of the <span class="struct">SERVER_SILO_MONITOR_REGISTRATION</span> 
  structure. This is among the inputs to <span class="function">PsRegisterMonitorServerSilo</span>. 
  That Microsoft’s programmers keep the names when transferring into the lasting
  <span class="struct">SERVER_SILO_MONITOR</span> is at least plausible. </p>
  <p>These NTOSP.H headers have type definitions for the several callbacks: </p>
  <ul>
    <li><span class="type">PSERVER_SILO_MONITOR_CREATE_CALLBACK</span> </li>
    <li><span class="type">PSERVER_SILO_MONITOR_TERMINATE_CALLBACK</span> </li>
    <li><span class="type">PSERVER_SILO_MONITOR_DRIVER_LOAD_CALLBACK</span> </li>
    <li><span class="type">PSERVER_SILO_MONITOR_DRIVER_UNLOAD_CALLBACK</span>
    </li>
    <li><span class="type">PSERVER_SILO_MONITOR_CONTEXT_CLEANUP_CALLBACK</span>
    </li>
  </ul>
  <p>They also both define the <span class="type">PESILO</span> type, which is an 
  argument to most of the callbacks, as a pointer to an otherwise undefined structure 
  named <span class="struct">_ESILO</span>. To some extent it doesn’t matter, but 
  this type definition of <span class="type">PESILO</span> is correct only for the 
  original Windows 10. By the 1511 release the <span class="struct">ESILO</span> 
  exists no more and the <span class="type">PESILO</span> actually points to an
  <span class="struct">EJOB</span>. </p>
  <div class="Footer">
    <p class="Dates">This page was created on 21st
    <a href="../../../../../../../new/22/07.htm">August 2022</a>. </p>
    <!--webbot bot="Include" U-Include="../../../../_include/c22.htm" TAG="BODY" startspan -->

<p class="Copyright">Copyright © 2022. Geoff Chappell. All rights reserved. 
<a href="../../../../../../../about/terms.htm">Conditions apply</a>. </p>

<!--webbot bot="Include" endspan i-checksum="5890" -->
  </div>
</div>

</body>

</html>
