<!doctype html>
<html lang="en">

<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<title>ETW_QUEUE_ENTRY</title>
<link rel="stylesheet" type="text/css" href="../../../../../../../_styles/master.css">
<link rel="stylesheet" type="text/css" href="../../../../../../../_styles/document.css">
<link rel="stylesheet" type="text/css" href="../../../../_styles/km.css">
<script type="text/javascript" src="../../../../../../../_scripts/master.js"></script>
<script type="text/javascript" src="../../../../../../../_scripts/document.js"></script>
<script type="text/javascript" src="../../../../_scripts/km.js" defer></script>
</head>

<body>

<!--webbot bot="Include" U-Include="../../../../_include/noscript.htm" TAG="BODY" startspan -->

<div class="NoScript" id="Banner">
  <div id="Links">
    <ul class="LinkList">
      <li> 
      <ul class="PreferNoWrap">
        <li class="LinkListItem"><a href="../../../../../../../index.htm">Home</a> </li><!--
     --><li class="LinkListItem"><a target="_self" href="../../../../toc.htm">Table of Contents</a> </li><!--
     --><li class="LinkListItem"><a href="../../../../../../../about/index.htm">About This Site</a> </li>
      </ul>
      <ul class="PreferNoWrap">
        <li class="LinkListItem"><a href="../../../../../../../new/index.htm">What’s New?</a> </li><!--
     --><li class="LinkListItem"><a href="../../../../../../../feedback/index.htm">Feedback</a> </li><!--
     --><li class="LinkListItem"><a href="../../../../../../../consult/index.htm">Consult</a> </li>
      </ul>
      </li>
    </ul>
  </div>
  <div id="Logo">
    <p><span class="PreferNoWrap">Geoff Chappell -</span> <span class="PreferNoWrap">Software Analyst</span> </p>
  </div>
</div>

<!--webbot bot="Include" endspan i-checksum="48540" -->
<div class="Main">
  <h1>ETW_QUEUE_ENTRY </h1>
  <p>Each <span class="struct">ETW_QUEUE_ENTRY</span> structure supports the delivery 
  of a notification to one user-mode registration of an event provider. </p>
  <h2>Documentation Status </h2>
  <p>The <span class="struct">ETW_QUEUE_ENTRY</span> structure is not documented.
  </p>
  <h2>Layout </h2>
  <p>Though the <span class="struct">ETW_QUEUE_ENTRY</span> is very much an implementation 
  detail of the kernel’s own bookkeeping, it has not changed much. The following 
  changes of size are known: </p>
  <table class="Sizes">
    <colgroup>
      <col class="Version"><col class="Size" span="2">
    </colgroup>
    <thead>
      <tr>
        <th>Versions </th>
        <th>Size (x86) </th>
        <th>Size (x64) </th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td>6.0 to 6.1 </td>
        <td>0x18 </td>
        <td>0x28 </td>
      </tr>
      <tr>
        <td>6.2 to 10.0 </td>
        <td>0x20 </td>
        <td>0x38 </td>
      </tr>
    </tbody>
  </table>
  <p>The preceding sizes, and the offsets, types and names in the table below are 
  from Microsoft’s public symbol files for the kernel, starting with Windows 8. 
  Since symbol files for earlier versions do not contain type information for the
  <span class="struct">ETW_QUEUE_ENTRY</span>, what’s shown for them is instead 
  inferred from what use these versions of the kernel are seen to make of the structure 
  in comparison with those for which Microsoft’s names and types are known. Where 
  the correspondence is close, it seems reasonable to infer continuity. </p>
  <table class="Struct">
    <colgroup>
      <col class="Offset" span="2"><col class="Definition">
      <col class="Versions">
    </colgroup>
    <thead>
      <tr>
        <th>Offset (x86) </th>
        <th>Offset (x64) </th>
        <th>Definition </th>
        <th>Versions </th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td>0x00 </td>
        <td>0x00 </td>
        <td>
        <pre class="source">LIST_ENTRY ListEntry;</pre>
        </td>
        <td>6.0 and higher </td>
      </tr>
      <tr>
        <td>0x08 </td>
        <td>0x10 </td>
        <td>
        <pre class="source"><a href="../../../api/etw/notify/notification_header.htm">ETWP_NOTIFICATION_HEADER</a> *DataBlock;</pre>
        </td>
        <td>6.0 and higher </td>
      </tr>
      <tr>
        <td>0x0C </td>
        <td>0x18 </td>
        <td>
        <pre class="source"><a href="etw_reg_entry/index.htm">ETW_REG_ENTRY</a> *RegEntry;</pre>
        </td>
        <td>6.0 and higher </td>
      </tr>
      <tr>
        <td>0x10 </td>
        <td>0x20 </td>
        <td>
        <pre class="source">ETW_REG_ENTRY *ReplyObject;</pre>
        </td>
        <td>6.2 and higher </td>
      </tr>
      <tr>
        <td>0x14 </td>
        <td>0x28 </td>
        <td>
        <pre class="source">PVOID WakeReference;</pre>
        </td>
        <td>6.2 and higher </td>
      </tr>
      <tr>
        <td rowspan="2">0x10 (6.0 to 6.1); <br>
        0x18 </td>
        <td rowspan="2">0x20 (6.0 to 6.1); <br>
        0x30 </td>
        <td>
        <pre class="source">ULONG RegIndex;</pre>
        </td>
        <td>6.0 to 6.1 </td>
      </tr>
      <tr>
        <td>
        <pre class="source">USHORT RegIndex;</pre>
        </td>
        <td>6.2 and higher </td>
      </tr>
      <tr>
        <td rowspan="2">0x14 (6.0 to 6.1); <br>
        0x1A </td>
        <td rowspan="2">0x24 (6.0 to 6.1); <br>
        0x32 </td>
        <td>
        <pre class="source">ULONG ReplyIndex;</pre>
        </td>
        <td>6.0 to 6.1 </td>
      </tr>
      <tr>
        <td>
        <pre class="source">USHORT ReplyIndex;</pre>
        </td>
        <td>6.2 and higher </td>
      </tr>
      <tr>
        <td>0x1C </td>
        <td>0x34 </td>
        <td>
        <pre class="source">ULONG Flags;</pre>
        </td>
        <td>6.2 and higher </td>
      </tr>
    </tbody>
  </table>
  <p>The one notification may be sent to multiple registrations. All receive the 
  same (referenced-counted) copy of the sending process’s data block but each transmission 
  has its own <span class="struct">ETW_QUEUE_ENTRY</span>. The one process may have 
  multiple notifications in progress. All the queue entries are kept in a double-linked 
  list linked through the <span class="member">ListEntry</span>. The queue itself 
  is a <span class="struct">LIST_ENTRY</span> in an <span class="struct">
  <a href="../../../api/etw/notify/data_source.htm">ETW_DATA_SOURCE</a></span> structure 
  whose address is kept as the <span class="member">EtwDataSource</span> in the 
  process’s <span class="struct"><a href="../ps/eprocess/index.htm">EPROCESS</a></span>.
  </p>
  <p>The <span class="member">RegIndex</span> is the system-wide 0-based
  <span class="member">Index</span> of the notifyee <span class="struct">ETW_REG_ENTRY</span>, 
  apparently included just for convenience. What the <span class="member">ReplyIndex</span> 
  indexes is the <span class="member">ReplySlot</span> array in the notifyee
  <span class="struct">ETW_REG_ENTRY</span>. Before version 6.2, the indexed
  <span class="member">ReplySlot</span> points to the reply object. The
  <span class="member">ReplyIndex</span> is thus the queue entry’s access to the 
  reply object. This access is reversed in later versions: the queue entry holds 
  the reply object’s address and the indexed <span class="member">ReplySlot</span> 
  points to the queue entry. </p>
  <div class="Footer">
    <p class="Dates">This page was created on 27th November 2016 but was not published 
    until 31st <a href="../../../../../../../new/18/12.htm">December 2018</a>. It 
    was last modified on 28th <a href="../../../../../../../new/20/05.htm">May 2020</a>.
    </p>
    <!--webbot bot="Include" U-Include="../../../../_include/c1820.htm" TAG="BODY" startspan -->

<p class="Copyright">Copyright © 2018-2020. Geoff Chappell. All rights reserved. 
<a href="../../../../../../../about/terms.htm">Conditions apply</a>. </p>

<!--webbot bot="Include" endspan i-checksum="5149" -->
  </div>
</div>

</body>

</html>
