<html>

<head>
<title>ETW_PMC_SUPPORT</title>
<link rel="stylesheet" type="text/css" href="../../../../../../../_styles/master.css">
<link rel="stylesheet" type="text/css" href="../../../../../../../_styles/document.css">
<link rel="stylesheet" type="text/css" href="../../../../_styles/km.css">
<script type="text/javascript" src="../../../../../../../_scripts/master.js"></script>
<script type="text/javascript" src="../../../../../../../_scripts/document.js"></script>
<script type="text/javascript" src="../../../../_scripts/km.js"></script>
</head>

<body>

<!--webbot bot="Include" U-Include="../../../../_include/noscript.htm" TAG="BODY" startspan -->

<div class="NoScript" id="Banner">
  <div id="Links">
    <ul class="LinkList">
      <li class="LinkListItem"><a href="../../../../../../../index.htm"><span>Home</span></a> </li>
      <li class="LinkListItem"><a target="_self" href="../../../../toc.htm"><span>Table of Contents</span></a> </li>
      <li class="LinkListItem"><a href="../../../../../../../about/index.htm"><span>About This Site</span></a> </li>
      <li class="LinkListItem"><a href="../../../../../../../new/index.htm"><span>What’s New?</span></a> </li>
      <li class="LinkListItem"><a href="../../../../../../../feedback/index.htm"><span>Feedback</span></a> </li>
      <li class="LinkListItem"><a href="../../../../../../../consult/index.htm"><span>Consult</span></a> </li>
    </ul>
  </div>
  <div id="Logo">
    <p>Geoff Chappell, Software Analyst </p>
  </div>
</div>

<!--webbot bot="Include" endspan i-checksum="29544" -->
<h1>ETW_PMC_SUPPORT </h1>
<p>The <span class="struct">ETW_PMC_SUPPORT</span> structure is created for an event logger when processor performance monitoring is enabled for it. Such 
requests reach the kernel only through <span class="function">
<a href="../../ex/sysinfo/set.htm">ZwSetSystemInformation</a></span> or
<span class="function">NtSetSystemInformation</span> when given the information 
class <span class="constant">SystemPerformanceTraceInformation</span> (0x1F) with 
an information buffer whose first dword is <span class="constant">EventTraceProfileEventListInformation</span> 
(0x0E) or <span class="constant">EventTraceProfileCounterListInformation</span> 
(0x0F). </p>
<h2>Documentation Status </h2>
<p>The <span class="struct">ETW_PMC_SUPPORT</span> structure is not documented.
</p>
<h2>Layout </h2>
<p>The <span class="struct">ETW_PMC_SUPPORT</span> structure is 0x24 or 0x28 bytes in 
32-bit and 64-bit Windows, respectively. Offsets, types and names in the table below 
are from symbol files for the kernel in Windows 8 and higher. </p>
<table class="Struct">
  <colgroup>
    <col class="Offset"><col class="Definition">
  </colgroup>
  <tr>
    <th>Offset </th>
    <th>Definition </th>
  </tr>
  <tr>
    <td>0x00 </td>
    <td>
    <pre class="source"><a href="../../ke/profobj/kprofile_source.htm">KPROFILE_SOURCE</a> Source [4];</pre>
    </td>
  </tr>
  <tr>
    <td>0x10 </td>
    <td>
    <pre class="source">ULONG volatile HookIdCount;</pre>
    </td>
  </tr>
  <tr>
    <td>0x14 </td>
    <td>
    <pre class="source">USHORT HookId [4];</pre>
    </td>
  </tr>
  <tr>
    <td>0x1C </td>
    <td>
    <pre class="source">ULONG volatile CountersCount;</pre>
    </td>
  </tr>
  <tr>
    <td>0x20 </td>
    <td>
    <pre class="source">HAL_PMC_COUNTERS *ProcessorCtrs [ANYSIZE_ARRAY];</pre>
    </td>
  </tr>
</table>
<p>The structure is always allocated from non-paged no-execute pool. Its address 
is kept as the <span class="member">PmcData</span> member of the
<span class="struct"><a href="wmi_logger_context/index.htm">WMI_LOGGER_CONTEXT</a></span> 
that represents the event logger. </p>
<p>Each logger can nominate up to four counters. These are selected from the
<span class="enum">KPROFILE_SOURCE</span> enumeration that is defined in WDM.H and 
lists the types of information that the HAL may keep about processor performance. 
The profile sources are provided as the <span class="member">ProfileSources</span> member of the
<span class="struct"><a href="profile_counter.htm">EVENT_TRACE_PROFILE_COUNTER_INFORMATION</a></span> 
that is the required input for the relevant case of <span class="function">ZwSetSystemInformation</span>.
</p>
<p>The <span class="member">ProcessorCtrs</span> array has as many elements as there 
can ever be processors. Each is a pointer to a <span class="struct">HAL_PMC_COUNTERS</span> structure 
for which Microsoft’s symbol files do not provide type information. From the 
NTOSP.H header in the Enterprise edition of the Windows Driver Kit (WDK) for Windows 
10 version 1511, it is known that Microsoft defines the type <span class="type">PMC_HANDLE</span> 
for this pointer. </p>
<div class="Footer">
  <p class="Dates">This page was created on 30th 
  <a href="../../../../../../../new/16/11.htm">November 2016</a> and was last 
  modified on 23rd November 2018. </p>
  <!--webbot bot="Include" U-Include="../../../../_include/c1618.htm" TAG="BODY" startspan -->

<p class="Copyright">Copyright © 2016-2018. Geoff Chappell. All rights reserved. 
<a href="../../../../../../../about/terms.htm">Conditions apply</a>. </p>

<!--webbot bot="Include" endspan i-checksum="5013" -->
</div>

</body>

</html>
