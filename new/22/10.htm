<!doctype html>
<html lang="en">

<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<title>New and Revised in October and November 2022</title>
<link rel="stylesheet" type="text/css" href="../../_styles/master.css">
<link rel="stylesheet" type="text/css" href="../../_styles/document.css">
<link rel="stylesheet" type="text/css" href="../../_styles/tree.css">
<script type="text/javascript" src="../../_scripts/master.js"></script>
<script type="text/javascript" src="../../_scripts/document.js"></script>
<script type="text/javascript" src="../../_scripts/tree.js" defer></script>
</head>

<body>

<!--webbot bot="Include" U-Include="../../_include/noscript.htm" TAG="BODY" startspan -->

<div class="NoScript Header" id="Banner">
  <div id="Links">
    <ul class="LinkList">
      <li> 
      <ul class="PreferNoWrap">
        <li class="LinkListItem"><a href="../../index.htm">Home</a> </li><!--
     --><li class="LinkListItem"><a target="_self" href="../../toc.htm">Table of Contents</a> </li><!--
     --><li class="LinkListItem"><a href="../../about/index.htm">About This Site</a> </li>
      </ul>
      <ul class="PreferNoWrap">
        <li class="LinkListItem"><a href="../index.htm">What’s New?</a> </li><!--
     --><li class="LinkListItem"><a href="../../feedback/index.htm">Feedback</a> </li><!--
     --><li class="LinkListItem"><a href="../../consult/index.htm">Consult</a> </li>
      </ul>
      </li>
    </ul>
  </div>
  <div id="Logo">
    <p><span class="PreferNoWrap">Geoff Chappell -</span> <span class="PreferNoWrap">Software Analyst</span> </p>
  </div>
</div>

<!--webbot bot="Include" endspan i-checksum="14880" -->
<div class="Main">
  <h1>New and Revised in October and November 2022 </h1>
  <p>Well into October I still had no idea where the month was going. One place 
  it headed to—but didn’t arrive—in my writing of new pages on kernel-mode structures 
  is the KSYSTEM_TIME. This 12-byte structure is on the one hand a simple dressing 
  of a 64-bit time but is on the other the oldest survivor in Windows of early techniques 
  for concurrent access without formal locking or waiting. In my opinion it’s much 
  neglected, and in the worst way, with commentators glossing over the extra high 
  part of the 64-bit time as if they and their readers understand it so well that 
  it’s barely worth a mention. After a week, off and on, at trying to write something 
  definitive, I say it’s not at all easy to explain! But much about timing in Windows 
  is not. And I anyway have a long record of finding complexity in things that others 
  happily pass over. For now, I add KSYSTEM_TIME to my much too large collection 
  of aborted write-ups. </p>
  <p>For diversion from my frustration at having not seen how to finish this one 
  write-up, I picked up my occasional relocation of old pages on kernel structures. 
  The aim is that these eventually are all arranged according to which of Microsoft’s 
  headers they’re defined in—well, as much as this is revealed in the public symbol 
  files, which is very much more than anyone but me seems to care about or perhaps 
  even to have noticed. </p>
  <p>Though it’s possible, and even likely, that the many unpublished headers whose 
  existence (along with some content) Microsoft has been disclosing in public symbol 
  files for the last decade are themselves generated from other headers whose existence 
  is not recorded in the symbol files, what Microsoft has revealed about its organisation 
  of source code has no small impact on the study of Windows. I mean this on two 
  counts. </p>
  <p>One is prompted by the occasional nonsense from someone, often a Microsoft 
  programmer, claiming expert insight into whether correlation of supposedly reverse-engineered 
  information with Microsoft’s source tree proves, or at least suggests, that the 
  work was helped by access to source code, leaked or not. Though Microsoft certainly 
  does have programmers who know precisely what sort of material goes into symbol 
  files, most plainly don’t—if only because it’s just not what they work on—but 
  this doesn’t stop some of them from speaking as if their work for Microsoft as 
  programmers means they are uniquely well-informed about what’s possible for reverse 
  engineers. That they then are widely believed is no help to anyone. If I were 
  in computer forensics or software litigation, I’d worry for what such ready acceptance 
  of such claims to expert insight does for standards of proof. </p>
  <p>The second count is that reverse engineers can’t very well complain when the 
  integrity of their work is impugned. Most don’t, of course, because they don’t 
  care. Especially for computer security, what reverse engineering of Windows gets 
  done is often under such pressure that the researchers grasp for whatever they 
  can get, wherever it comes from, no questions asked—and a whole industry of people 
  who in other circumstances might like to think they know better or would aim higher 
  goes along with the expedience. Even the most prominent reverse engineers of Windows 
  leave notably little record of where their information comes from. If they get 
  accused of lifting it from the back of a truck, it’s because that’s very much 
  how it looks. </p>
  <p>My number one mission in what time remains to me is to get the reverse engineering 
  of Windows onto firm ground. But I do feel very much to be the lone voice. </p>
  <p>Relocating my pages about kernel-mode structures inevitably got me looking 
  again at the many pages I have written, on and off, over many years, about Event 
  Tracing for Windows (ETW). If you were looking for an example of undocumented 
  Windows internals that Microsoft uses for its own products but might usefully 
  be taken up into third-party products to develop a competitive market—in this 
  case, of diagnostics tools or for security monitoring—then ETW is the poster child. 
  A casual reader might think ETW is well documented, and some of it is, even copiously, 
  but there is so much more to it and has been for decades. On this too I have long 
  thought myself the lone voice, though I have of course suspected that some of 
  the “so much more” is researched privately or is learnt from Microsoft, including 
  under NDA. That an industry of Windows programmers has not got the power of ETW 
  to wide attention is an enduring shame. I do what I can, but there’s only one 
  of me. </p>
  <p>Less in the foreground of my studies, and for much less time, is the rich functionality 
  that has developed through the last decade for Processor Power Management (PPM). 
  I’ve inexcusably let this pass by without writing about it. The security industry 
  seems not to have had much interest, perhaps because what goes on is just a bit 
  too far from easy exploitation. I try not to think like a security researcher 
  but instead to look for opportunities for novel programming. There’s maybe not 
  much of that here, either, and yet I can’t escape thinking that something in this 
  topic might better have public interest—and so I make a little time for it. </p>
  <p>Inevitably, writing about any per-processor feature gets me diverted to another 
  of my occasional hobby horses: processors. Back in 2016 I noticed there was 
  increased kernel-mode support for what Hyper-V does with processors. Others 
  have since got interested for all their different reasons. Revisiting was 
  irresistable. </p>
  <p>Also inevitably, I didn’t finish anything like as much as I wanted! When 
  I’ll get back to any of this, let alone with energy and time to finish what 
  I’ve started here, I don’t know. </p>
  <h2>Home </h2>
  <div class="Tree">
    <ul>
      <li class="Expanded Branch">Personal 
      <ul>
        <li class="Expanded Branch">Music 
        <ul>
          <li class="Expanded Branch">Classical
          <ul>
            <li class="Expanded Branch">2022 
            <ul>
              <li><a href="../../personal/music/classical/22/1117.htm">Of Earth, Sea, and Sky</a> </li>
            </ul>
            </li>
          </ul>
          </li>
        </ul>
        </li>
      </ul>
      </li>
    </ul>
  </div>
  <h2>Kernel-Mode Windows </h2>
  <div class="Tree">
    <ul>
      <li class="Expanded Branch">Kernel 
      <ul>
        <li class="Expanded Branch">Exported Functions and Variables 
        <ul>
          <li class="Expanded Branch"><a href="../../studies/windows/km/ntoskrnl/api/hvilib/hviintel/index.htm">Hypervisor Interface</a> (new) 
          <ul>
            <li><a href="../../studies/windows/km/ntoskrnl/api/hvilib/hviintel/getdebugdeviceoptions.htm">HviGetDebugDeviceOptions</a> </li>
            <li><a href="../../studies/windows/km/ntoskrnl/api/hvilib/hviintel/getenlightenmentinformation.htm">HviGetEnlightenmentInformation</a> </li>
            <li><a href="../../studies/windows/km/ntoskrnl/api/hvilib/hviintel/gethardwarefeatures.htm">HviGetHardwareFeatures</a> </li>
            <li><a href="../../studies/windows/km/ntoskrnl/api/hvilib/hviintel/gethypervisorfeatures.htm">HviGetHypervisorFeatures</a> </li>
            <li><a href="../../studies/windows/km/ntoskrnl/api/hvilib/hviintel/gethypervisorinterface.htm">HviGetHypervisorInterface</a> </li>
            <li><a href="../../studies/windows/km/ntoskrnl/api/hvilib/hviintel/gethypervisorvendorandmaxfunction.htm">HviGetHypervisorVendorAndMaxFunction</a> </li>
            <li><a href="../../studies/windows/km/ntoskrnl/api/hvilib/hviintel/gethypervisorversion.htm">HviGetHypervisorVersion</a> </li>
            <li><a href="../../studies/windows/km/ntoskrnl/api/hvilib/hviintel/getimplementationlimits.htm">HviGetImplementationLimits</a> </li>
            <li><a href="../../studies/windows/km/ntoskrnl/api/hvilib/hviintel/isanyhypervisorpresent.htm">HviIsAnyHypervisorPresent</a> </li>
            <li><a href="../../studies/windows/km/ntoskrnl/api/hvilib/hviintel/ishypervisormicrosoftcompatible.htm">HviIsHypervisorMicrosoftCompatible</a> </li>
            <li><a href="../../studies/windows/km/ntoskrnl/api/hvilib/hviintel/ishypervisorvendormicrosoft.htm">HviIsHypervisorVendorMicrosoft</a> </li>
            <li><a href="../../studies/windows/km/ntoskrnl/api/hvilib/hviintel/isiommuinuse.htm">HviIsIommuInUse</a> </li>
          </ul>
          </li>
        </ul>
        </li>
        <li class="Expanded Branch">User-Defined Types  
        <ul>
          <li class="Expanded Branch">Kernel-Mode 
          <ul>
            <li class="Expanded Branch">hal.h 
            <ul>
              <li><a href="../../studies/windows/km/ntoskrnl/inc/ntos/hal/hal_dispatch.htm">HAL_DISPATCH</a> </li>
              <li><a href="../../studies/windows/km/ntoskrnl/inc/ntos/hal/hal_platform_timer_source.htm">HAL_PLATFORM_TIMER_SOURCE</a> </li>
              <li><a href="../../studies/windows/km/ntoskrnl/inc/ntos/hal/hal_private_dispatch.htm">HAL_PRIVATE_DISPATCH</a> </li>
            </ul>
            </li>
            <li class="Expanded Branch">ke.h 
            <ul>
              <li><a href="../../studies/windows/km/ntoskrnl/inc/ntos/ke/kwait_block_state.htm">KWAIT_BLOCK_STATE</a> (new) </li>
              <li><a href="../../studies/windows/km/ntoskrnl/inc/ntos/ke/kwait_state.htm">KWAIT_STATE</a> (new) </li>
              <li><a href="../../studies/windows/km/ntoskrnl/inc/ntos/ke/kwait_status_register.htm">KWAIT_STATUS_REGISTER</a> (new) </li>
            </ul>
            </li>
            <li class="Expanded Branch">ke_x.h 
            <ul>
              <li><a href="../../studies/windows/km/ntoskrnl/inc/ntos/ke_x/kmutex.htm">KMUTEX</a> (new) </li>
              <li><a href="../../studies/windows/km/ntoskrnl/inc/ntos/ke_x/kwait_block.htm">KWAIT_BLOCK</a> (new) </li>
            </ul>
            </li>
            <li class="Expanded Branch">pop.h 
            <ul>
              <li>POP_POWER_SETTING_VALUES (new, in progress) </li>
              <li>POP_PPM_PROFILE (new, in progress) </li>
              <li>PPM_POLICY_SETTINGS_MASK (new, in progress) </li>
            </ul>
            </li>
            <li class="Expanded Branch">procpowr.h 
            <ul>
              <li><a href="../../studies/windows/km/ntoskrnl/inc/ntos/procpowr/ppm_driver_dispatch_table.htm">PPM_DRIVER_DISPATCH_TABLE</a> (new) </li>
              <li>PPM_IDLE_STATE (new, in progress) </li>
              <li>PPM_IDLE_STATES (new, in progress) </li>
              <li>PROCESSOR_IDLE_STATES_EX (new, in progress) </li>
              <li>PROCESSOR_IDLE_STATE_EX (new, in progress) </li>
              <li><a href="../../studies/windows/km/ntoskrnl/inc/ntos/procpowr/processor_power_state.htm">PROCESSOR_POWER_STATE</a> </li>
            </ul>
            </li>
          </ul>
          </li>
          <li class="Expanded Branch">API 
          <ul>
            <li class="Expanded Branch">ntetw.h
            <ul>
              <li><a href="../../studies/windows/km/ntoskrnl/inc/api/ntetw/etw_kernel_header_extension.htm">ETW_KERNEL_HEADER_EXTENSION</a> </li>
              <li><a href="../../studies/windows/km/ntoskrnl/inc/api/ntetw/etw_notification_header.htm">ETW_NOTIFICATION_HEADER</a> </li>
              <li><a href="../../studies/windows/km/ntoskrnl/inc/api/ntetw/etw_notification_type.htm">ETW_NOTIFICATION_TYPE</a> </li>
              <li><a href="../../studies/windows/km/ntoskrnl/inc/api/ntetw/event_trace_groupmask_information.htm">EVENT_TRACE_GROUPMASK_INFORMATION</a> </li>
              <li><a href="../../studies/windows/km/ntoskrnl/inc/api/ntetw/event_trace_information_class.htm">EVENT_TRACE_INFORMATION_CLASS</a> </li>
              <li><a href="../../studies/windows/km/ntoskrnl/inc/api/ntetw/event_trace_performance_information.htm">EVENT_TRACE_PERFORMANCE_INFORMATION</a> </li>
              <li><a href="../../studies/windows/km/ntoskrnl/inc/api/ntetw/event_trace_profile_counter_information.htm">EVENT_TRACE_PROFILE_COUNTER_INFORMATION</a> </li>
              <li><a href="../../studies/windows/km/ntoskrnl/inc/api/ntetw/event_trace_spinlock_information.htm">EVENT_TRACE_SPINLOCK_INFORMATION</a> </li>
              <li><a href="../../studies/windows/km/ntoskrnl/inc/api/ntetw/event_trace_version_information.htm">EVENT_TRACE_VERSION_INFORMATION</a> </li>
            </ul>
            </li>
            <li class="Expanded Branch">ntexapi.h
            <ul>
              <li><a href="../../studies/windows/km/ntoskrnl/inc/api/ntexapi/hv_details.htm">HV_DETAILS</a> </li>
              <li><a href="../../studies/windows/km/ntoskrnl/inc/api/ntexapi/system_hypervisor_detail_information.htm">SYSTEM_HYPERVISOR_DETAIL_INFORMATION</a> </li>
              <li><a href="../../studies/windows/km/ntoskrnl/inc/api/ntexapi/system_hypervisor_query_information.htm">SYSTEM_HYPERVISOR_QUERY_INFORMATION</a> </li>
            </ul>
            </li>
            <li class="Expanded Branch">ntexapi_x.h
            <ul>
              <li><a href="../../studies/windows/km/ntoskrnl/inc/api/ntexapi_x/kuser_shared_data/index.htm">KUSER_SHARED_DATA</a> </li>
            </ul>
            </li>
            <li class="Expanded Branch">ntwmi.h
            <ul>
              <li><a href="../../studies/windows/km/ntoskrnl/inc/api/ntwmi/etw_buffer_state.htm">ETW_BUFFER_STATE</a> </li>
              <li class="Expanded Branch"><a href="../../studies/windows/km/ntoskrnl/inc/api/ntwmi/traceheaders/index.htm">Trace Headers</a> (revision in progress) 
              <ul>
                <li><a href="../../studies/windows/km/ntoskrnl/inc/api/ntwmi/traceheaders/event_instance_guid_header.htm">EVENT_INSTANCE_GUID_HEADER</a> (revision in progress) </li>
                <li><a href="../../studies/windows/km/ntoskrnl/inc/api/ntwmi/traceheaders/message_trace_header.htm">MESSAGE_TRACE_HEADER</a> (revision in progress) </li>
                <li><a href="../../studies/windows/km/ntoskrnl/inc/api/ntwmi/traceheaders/perfinfo_trace_header.htm">PERFINFO_TRACE_HEADER</a> (revision in progress) </li>
                <li><a href="../../studies/windows/km/ntoskrnl/inc/api/ntwmi/traceheaders/system_trace_header.htm">SYSTEM_TRACE_HEADER</a> (revision in progress) </li>
              </ul>
              </li>
              <li class="Expanded Branch"><a href="../../studies/windows/km/ntoskrnl/inc/api/ntwmi/wmi_buffer_header/index.htm">WMI_BUFFER_HEADER</a> (revision in progress) 
              <ul>
                <li><a href="../../studies/windows/km/ntoskrnl/inc/api/ntwmi/wmi_buffer_header/bufferflag.htm">BufferFlag</a> </li>
                <li><a href="../../studies/windows/km/ntoskrnl/inc/api/ntwmi/wmi_buffer_header/buffertype.htm">BufferType</a> </li>
              </ul>
              </li>
              <li><a href="../../studies/windows/km/ntoskrnl/inc/api/ntwmi/wmi_buffer_state.htm">WMI_BUFFER_STATE</a> </li>
              <li><a href="../../studies/windows/km/ntoskrnl/inc/api/ntwmi/wmi_client_context.htm">WMI_CLIENT_CONTEXT</a> </li>
              <li><a href="../../studies/windows/km/ntoskrnl/inc/api/ntwmi/wmi_contextswap.htm">WMI_CONTEXTSWAP</a> </li>
            </ul>
            </li>
          </ul>
          </li>
          <li class="Expanded Branch">Shared 
          <ul>
            <li class="Expanded Branch">evntcons.h
            <ul>
              <li><a href="../../studies/windows/km/ntoskrnl/inc/shared/evntcons/event_header.htm">EVENT_HEADER</a> (revision in progress) </li>
            </ul>
            </li>
            <li class="Expanded Branch">evntrace.h
            <ul>
              <li><a href="../../studies/windows/km/ntoskrnl/inc/shared/evntrace/event_instance_header.htm">EVENT_INSTANCE_HEADER</a> (revision in progress) </li>
              <li><a href="../../studies/windows/km/ntoskrnl/inc/shared/evntrace/event_trace_header.htm">EVENT_TRACE_HEADER</a> (revision in progress) </li>
              <li><a href="../../studies/windows/km/ntoskrnl/inc/shared/evntrace/trace_logfile_header.htm">TRACE_LOGFILE_HEADER</a> (revision in progress) </li>
            </ul>
            </li>
            <li class="Expanded Branch">hvgdk_mini.h 
            <ul>
              <li><a href="../../studies/windows/km/ntoskrnl/inc/shared/hvgdk_mini/hv_cpuid_function.htm">HV_CPUID_FUNCTION</a> </li>
              <li><a href="../../studies/windows/km/ntoskrnl/inc/shared/hvgdk_mini/hv_cpuid_result.htm">HV_CPUID_RESULT</a> </li>
              <li><a href="../../studies/windows/km/ntoskrnl/inc/shared/hvgdk_mini/hv_enlightenment_information.htm">HV_ENLIGHTENMENT_INFORMATION</a> </li>
              <li><a href="../../studies/windows/km/ntoskrnl/inc/shared/hvgdk_mini/hv_hypervisor_features.htm">HV_HYPERVISOR_FEATURES</a> </li>
              <li><a href="../../studies/windows/km/ntoskrnl/inc/shared/hvgdk_mini/hv_hypervisor_hardware_features.htm">HV_HYPERVISOR_HARDWARE_FEATURES</a> </li>
              <li><a href="../../studies/windows/km/ntoskrnl/inc/shared/hvgdk_mini/hv_hypervisor_interface.htm">HV_HYPERVISOR_INTERFACE</a> (new) </li>
              <li><a href="../../studies/windows/km/ntoskrnl/inc/shared/hvgdk_mini/hv_hypervisor_interface_info.htm">HV_HYPERVISOR_INTERFACE_INFO</a> </li>
              <li><a href="../../studies/windows/km/ntoskrnl/inc/shared/hvgdk_mini/hv_hypervisor_nested_virt_features.htm">HV_HYPERVISOR_NESTED_VIRT_FEATURES</a> (new, in progress) </li>
              <li><a href="../../studies/windows/km/ntoskrnl/inc/shared/hvgdk_mini/hv_hypervisor_version_info.htm">HV_HYPERVISOR_VERSION_INFO</a> </li>
              <li><a href="../../studies/windows/km/ntoskrnl/inc/shared/hvgdk_mini/hv_implementation_limits.htm">HV_IMPLEMENTATION_LIMITS</a> </li>
              <li><a href="../../studies/windows/km/ntoskrnl/inc/shared/hvgdk_mini/hv_partition_privilege_mask.htm">HV_PARTITION_PRIVILEGE_MASK</a> </li>
              <li><a href="../../studies/windows/km/ntoskrnl/inc/shared/hvgdk_mini/hv_uint128.htm">HV_UINT128</a> (new) </li>
              <li><a href="../../studies/windows/km/ntoskrnl/inc/shared/hvgdk_mini/hv_vendor_and_max_function.htm">HV_VENDOR_AND_MAX_FUNCTION</a> </li>
              <li><a href="../../studies/windows/km/ntoskrnl/inc/shared/hvgdk_mini/hv_x64_enlightenment_information.htm">HV_X64_ENLIGHTENMENT_INFORMATION</a> </li>
              <li><a href="../../studies/windows/km/ntoskrnl/inc/shared/hvgdk_mini/hv_x64_hypervisor_features.htm">HV_X64_HYPERVISOR_FEATURES</a> </li>
              <li><a href="../../studies/windows/km/ntoskrnl/inc/shared/hvgdk_mini/hv_x64_hypervisor_hardware_features.htm">HV_X64_HYPERVISOR_HARDWARE_FEATURES</a> </li>
            </ul>
            </li>
          </ul>
          </li>
        </ul>
        </li>
        <li class="Expanded Branch">Source Code 
        <ul>
          <li class="Expanded Branch">Headers 
          <ul>
            <li class="Expanded Branch">E 
            <ul>
              <li><a href="../../studies/windows/km/ntoskrnl/source/inc/evntcons.htm">evntcons.h</a> </li>
              <li><a href="../../studies/windows/km/ntoskrnl/source/inc/evntrace.htm">evntrace.h</a> </li>
            </ul>
            </li>
            <li class="Expanded Branch">H 
            <ul>
              <li><a href="../../studies/windows/km/ntoskrnl/source/inc/hal.htm">hal.h</a> </li>
              <li><a href="../../studies/windows/km/ntoskrnl/source/inc/hvgdk_mini.htm">hvgdk_mini.h</a> (so much added that it’s mostly new) </li>
            </ul>
            </li>
            <li class="Expanded Branch">N 
            <ul>
              <li><a href="../../studies/windows/km/ntoskrnl/source/inc/ntetw.htm">ntetw.h</a> </li>
              <li><a href="../../studies/windows/km/ntoskrnl/source/inc/ntkeapi_x.htm">ntkeapi_x.h</a> </li>
              <li><a href="../../studies/windows/km/ntoskrnl/source/inc/ntwmi.htm">ntwmi.h</a> </li>
            </ul>
            </li>
          </ul>
          </li>
        </ul>
        </li>
        <li class="Expanded Branch">Event Providers 
        <ul>
          <li><a href="../../studies/windows/km/ntoskrnl/events/microsoft-windows-kernel-processor-power.htm">Kernel-Processor-Power</a> (new) </li>
        </ul>
        </li>
      </ul>
      </li>
      <li class="Expanded Branch">Processor Support 
      <ul>
        <li><a href="../../studies/windows/km/cpu/cpuid/index.htm">The CPUID Instruction</a> </li>
      </ul>
      </li>
    </ul>
  </div>
  <div class="Footer">
    <!--webbot bot="Include" U-Include="../../_include/c22.htm" TAG="BODY" startspan -->

<p class="Copyright">Copyright © 2022. Geoff Chappell. All rights reserved.  
<a href="../../about/terms.htm">Conditions apply</a>. </p>

<!--webbot bot="Include" endspan i-checksum="39972" -->
  </div>
</div>

</body>

</html>
