<!doctype html>
<html lang="en">

<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<title>ETW_REG_ENTRY</title>
<link rel="stylesheet" type="text/css" href="../../../../../../../../_styles/master.css">
<link rel="stylesheet" type="text/css" href="../../../../../../../../_styles/document.css">
<link rel="stylesheet" type="text/css" href="../../../../../_styles/km.css">
<script type="text/javascript" src="../../../../../../../../_scripts/master.js"></script>
<script type="text/javascript" src="../../../../../../../../_scripts/document.js"></script>
<script type="text/javascript" src="../../../../../_scripts/km.js" defer></script>
</head>

<body>

<!--webbot bot="Include" U-Include="../../../../../_include/noscript.htm" TAG="BODY" startspan -->

<div class="NoScript" id="Banner">
  <div id="Links">
    <ul class="LinkList">
      <li> 
      <ul class="PreferNoWrap">
        <li class="LinkListItem"><a href="../../../../../../../../index.htm">Home</a> </li><!--
     --><li class="LinkListItem"><a target="_self" href="../../../../../toc.htm">Table of Contents</a> </li><!--
     --><li class="LinkListItem"><a href="../../../../../../../../about/index.htm">About This Site</a> </li>
      </ul>
      <ul class="PreferNoWrap">
        <li class="LinkListItem"><a href="../../../../../../../../new/index.htm">What’s New?</a> </li><!--
     --><li class="LinkListItem"><a href="../../../../../../../../feedback/index.htm">Feedback</a> </li><!--
     --><li class="LinkListItem"><a href="../../../../../../../../consult/index.htm">Consult</a> </li>
      </ul>
      </li>
    </ul>
  </div>
  <div id="Logo">
    <p><span class="PreferNoWrap">Geoff Chappell -</span> <span class="PreferNoWrap">Software Analyst</span> </p>
  </div>
</div>

<!--webbot bot="Include" endspan i-checksum="33595" -->
<div class="Main">
  <h1>ETW_REG_ENTRY </h1>
  <p>The <span class="struct">ETW_REG_ENTRY</span> structure (formally
  <span class="struct">_ETW_REG_ENTRY</span>) is the kernel’s representation of 
  an event registration object. This can exist as a formal object, with handles 
  and access control, or not. The typical case in which an instance is created as 
  a formal object is when an event provider is registered from user mode. The object 
  type is named EtwRegistration. Note that the kernel has no exported variable for 
  this object type, presumably because only the kernel is ever involved in interpreting 
  a handle that refers to such an object. </p>
  <h2>Documentation Status </h2>
  <p>The <span class="struct">ETW_REG_ENTRY</span> structure is not documented.
  </p>
  <h2>Layout </h2>
  <p>For a non-trivial structure that is plainly very much internal to the kernel, 
  the <span class="struct">ETW_REG_ENTRY</span> has been relatively stable. There 
  has been growth, inevitably, but the only rearrangement was that version 6.2 compacts 
  a few members and moves them towards the end. </p>
  <table class="Sizes">
    <colgroup>
      <col class="Version"><col class="Size" span="2">
    </colgroup>
    <thead>
      <tr>
        <th>Version </th>
        <th>Size (x86) </th>
        <th>Size (x64) </th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td>6.0 to 6.1 </td>
        <td>0x2C </td>
        <td>0x50 </td>
      </tr>
      <tr>
        <td>6.2 to 6.3 </td>
        <td>0x28 </td>
        <td>0x50 </td>
      </tr>
      <tr>
        <td>10.0 to 2004 </td>
        <td>0x3C </td>
        <td>0x70 </td>
      </tr>
    </tbody>
  </table>
  <p>The preceding sizes, and the offsets, types and names in the table below are 
  from Microsoft’s symbol files for the kernel starting with Windows Vista. </p>
  <table class="Struct">
    <colgroup>
      <col class="Offset" span="2"><col class="Definition">
      <col class="Versions"><col class="Remarks">
    </colgroup>
    <thead>
      <tr>
        <th>Offset (x86) </th>
        <th>Offset (x64) </th>
        <th>Definition </th>
        <th>Versions </th>
        <th>Remarks </th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td>0x00 </td>
        <td>0x00 </td>
        <td>
        <pre class="source">LIST_ENTRY RegList;</pre>
        </td>
        <td>6.0 and higher </td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>0x08 </td>
        <td>0x10 </td>
        <td>
        <pre class="source">LIST_ENTRY GroupRegList;</pre>
        </td>
        <td>10.0 and higher </td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>0x08 (6.0 to 6.3); <br>
        0x10 </td>
        <td>0x10 (6.0 to 6.3); <br>
        0x20 </td>
        <td>
        <pre class="source"><a href="../etw_guid_entry.htm">ETW_GUID_ENTRY</a> *GuidEntry;</pre>
        </td>
        <td>6.0 and higher </td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>0x14 </td>
        <td>0x28 </td>
        <td>
        <pre class="source">ETW_GUID_ENTRY *GroupEntry;</pre>
        </td>
        <td>10.0 and higher </td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>0x0C (6.0 to 6.1) </td>
        <td>0x18 (6.0 to 6.1) </td>
        <td>
        <pre class="source">USHORT Index;</pre>
        </td>
        <td>6.0 to 6.1 </td>
        <td>next at 0x24 and 0x48 </td>
      </tr>
      <tr>
        <td>0x0E (6.0 to 6.1) </td>
        <td>0x1A (6.0 to 6.1) </td>
        <td>
        <pre class="source">USHORT Flags;</pre>
        </td>
        <td>6.0 to 6.1 </td>
        <td>next as <span class="type">UCHAR</span> at 0x26 and 0x4A </td>
      </tr>
      <tr>
        <td>0x10 (6.0 to 6.1) </td>
        <td>0x1C (6.0 to 6.1) </td>
        <td>
        <pre class="source">UCHAR EnableMask;</pre>
        </td>
        <td>6.0 to 6.1 </td>
        <td>next at 0x27 and 0x4B </td>
      </tr>
      <tr>
        <td>0x14 (6.0 to 6.1); <br>
        0x0C (6.2 to 6.3); <br>
        0x18 </td>
        <td>0x20 (6.0 to 6.1); <br>
        0x18 (6.2 to 6.3); <br>
        0x30 </td>
        <td>
        <pre class="source">union {
    /*  changing members, see below  */
};</pre>
        </td>
        <td>6.0 and higher </td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td rowspan="2">0x24 (6.0 to 6.1); <br>
        0x1C (6.2 to 6.3); <br>
        0x28 </td>
        <td rowspan="2">0x40 (6.0 to 6.1); <br>
        0x38 (6.2 to 6.3); <br>
        0x50 </td>
        <td>
        <pre class="source">union {
    <a href="../../ps/eprocess/index.htm">EPROCESS</a> *Process;
    struct {
        PVOID Callback;
        PVOID CallbackContext;
    };
};</pre>
        </td>
        <td>6.0 to 6.1 </td>
        <td>last member in 6.0 to 6.1 </td>
      </tr>
      <tr>
        <td>
        <pre class="source">union {
    EPROCESS *Process;
    struct {
        PVOID CallbackContext;
        PVOID Callback;
    };
};</pre>
        </td>
        <td>6.2 and higher </td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>0x24 (6.2 to 6.3); <br>
        0x30 </td>
        <td>0x48 (6.2 to 6.3); <br>
        0x60 </td>
        <td>
        <pre class="source">USHORT Index;</pre>
        </td>
        <td>6.2 and higher </td>
        <td>previously at 0x0C and 0x18 </td>
      </tr>
      <tr>
        <td rowspan="2">0x26 (6.2 to 6.3); <br>
        0x32 </td>
        <td rowspan="2">0x4A (6.2 to 6.3); <br>
        0x62 </td>
        <td>
        <pre class="source">union {
    UCHAR <a href="flags.htm">Flags</a>;
    struct {
        /*  bit fields, follow link  */
    };
};</pre>
        </td>
        <td>6.2 to 1511 </td>
        <td>previously <span class="type">USHORT</span> at 0x0E and 01A </td>
      </tr>
      <tr>
        <td>
        <pre class="source">union {
    USHORT Flags;
    struct {
        /*  bit fields, follow link  */
    };
};</pre>
        </td>
        <td>1607 and higher </td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>0x27 (6.2 to 6.3); <br>
        0x33 (10.0 to 1511); <br>
        0x34 </td>
        <td>0x4B (6.2 to 6.3); <br>
        0x63 (10.0 to 1511); <br>
        0x64 </td>
        <td>
        <pre class="source">UCHAR EnableMask;</pre>
        </td>
        <td>6.2 and higher </td>
        <td>previously at 0x10 and 0x1C; <br>
        last member in 6.2 to 6.3 </td>
      </tr>
      <tr>
        <td>0x34 (10.0 to 1511); <br>
        0x35 </td>
        <td>0x64 (10.0 to 1511); <br>
        0x65 </td>
        <td>
        <pre class="source">UCHAR GroupEnableMask;</pre>
        </td>
        <td>10.0 and higher </td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>0x36 </td>
        <td>0x66 </td>
        <td>
        <pre class="source">UCHAR HostEnableMask;</pre>
        </td>
        <td>2004 and higher </td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>0x37 </td>
        <td>0x67 </td>
        <td>
        <pre class="source">UCHAR HostGroupEnableMask;</pre>
        </td>
        <td>2004 and higher </td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>0x35 (10.0 to 1511); <br>
        0x36 (1607 to 1703) </td>
        <td>0x65 (10.0 to 1511); <br>
        0x66 (1607 to 1703) </td>
        <td>
        <pre class="source">BOOLEAN UseDescriptorType;</pre>
        </td>
        <td>10.0 to 1703 </td>
        <td>next in <span class="member">Flags</span> </td>
      </tr>
      <tr>
        <td>0x38 </td>
        <td>0x68 </td>
        <td>
        <pre class="source"><a href="../etw_provider_traits.htm">ETW_PROVIDER_TRAITS</a> *Traits;</pre>
        </td>
        <td>10.0 and higher </td>
        <td>last member in 10.0 and higher </td>
      </tr>
    </tbody>
  </table>
  <p>Any number of registrations can be opened to any one event provider. The
  <span class="struct">ETW_REG_ENTRY</span> structures for the registrations are 
  linked through the <span class="member">RegList</span> member to the
  <span class="member">RegListHead</span> in the <span class="struct">ETW_GUID_ENTRY</span> 
  that represents the provider (and whose address is the <span class="member">GuidEntry</span>). 
  There are also <span class="struct">ETW_REG_ENTRY</span> structures that exist 
  only to support a notification mechanism. These reply objects are not associated 
  with any provider. They have their own list, again linking through
  <span class="member">RegList</span>, but with a head that is an internal variable 
  in the kernel’s data. </p>
  <p>Each registration allows that its holder can write events through the provider. 
  On the other side, the provider can be accessed by as many as eight loggers, known 
  more formally as event tracing sessions. The eight bits of the
  <span class="member">EnableMask</span> track which of the possible loggers are 
  enabled. </p>
  <h3>Reply Queue and Slot </h3>
  <p>Space for four pointers in the middle of the structure is used very differently 
  in the different types of object. </p>
  <table class="Union">
    <tbody>
      <tr>
        <th>Offset (x86) </th>
        <th>Offset (x64) </th>
        <th>Definition </th>
        <th>Versions </th>
      </tr>
      <tr>
        <td>0x14 (6.1) </td>
        <td>0x20 (6.1) </td>
        <td>
        <pre class="source">ULONG SessionId;</pre>
        </td>
        <td>6.1 only </td>
      </tr>
      <tr>
        <td>0x14 (6.0 to 6.1); <br>
        0x0C (6.2 to 6.3); <br>
        0x18 </td>
        <td>0x20 (6.0 to 6.1); <br>
        0x18 (6.2 to 6.3); <br>
        0x30 </td>
        <td>
        <pre class="source"><a href="../etw_reply_queue.htm">ETW_REPLY_QUEUE</a> *ReplyQueue;</pre>
        </td>
        <td>6.0 and higher </td>
      </tr>
      <tr>
        <td rowspan="2">0x14 (6.0 to 6.1); <br>
        0x0C (6.2 to 6.3); <br>
        0x18 </td>
        <td rowspan="2">0x20 (6.0 to 6.1); <br>
        0x18 (6.2 to 6.3); <br>
        0x30 </td>
        <td>
        <pre class="source">ETW_REG_ENTRY *ReplySlot [4];</pre>
        </td>
        <td>6.0 to 6.1 </td>
      </tr>
      <tr>
        <td>
        <pre class="source"><a href="../etw_queue_entry.htm">ETW_QUEUE_ENTRY</a> *ReplySlot [4];</pre>
        </td>
        <td>6.2 and higher </td>
      </tr>
      <tr>
        <td>0x0C (6.2 to 6.3); <br>
        0x18 </td>
        <td>0x18 (6.2 to 6.3); <br>
        0x30 </td>
        <td>
        <pre class="source">struct {
    PVOID Caller;
    ULONG SessionId;
};</pre>
        </td>
        <td>6.2 and higher </td>
      </tr>
    </tbody>
  </table>
  <p>The <span class="member">ReplyQueue</span> is meaningful in a registration 
  object that has <span class="member">DbgReplyRegistration</span> set among the
  <span class="member">Flags</span> to denote that it exists to support the retrieval 
  of replies to a notification. </p>
  <p>A registration object for which <span class="member">DbgUserRegistration</span> 
  is set can be sent notifications which may request replies. The
  <span class="member">ReplySlot</span> array is how the replies are kept until 
  their retrieval. </p>
  <p>The <span class="member">SessionId</span> and later the
  <span class="member">Caller</span> are meaningful only for kernel-mode registrations, 
  i.e., when <span class="member">DbgKernelRegistration</span> is set. The
  <span class="member">Caller</span> is in fact older but was kept separately from 
  the <span class="struct">ETW_REG_ENTRY</span> as a member of the
  <span class="struct">
  <a href="../../../../api/etw/register/provider_table_entry.htm">ETW_PROVIDER_TABLE_ENTRY</a></span>.
  </p>
  <div class="Footer">
    <p class="Dates">This page was created on 27th
    <a href="../../../../../../../../new/16/11.htm">November 2016</a> and was last 
    modified on 17th October 2022. </p>
    <!--webbot bot="Include" U-Include="../../../../../_include/c1622.htm" TAG="BODY" startspan -->

<p class="Copyright">Copyright © 2016-2022. Geoff Chappell. All rights reserved. 
<a href="../../../../../../../../about/terms.htm">Conditions apply</a>. </p>

<!--webbot bot="Include" endspan i-checksum="14250" -->
  </div>
</div>

</body>

</html>
