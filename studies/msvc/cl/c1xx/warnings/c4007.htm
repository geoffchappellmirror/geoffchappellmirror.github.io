<html>

<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<title>Visual C++ Compiler Warning C4007</title>
<link rel="stylesheet" type="text/css" href="../../../../../_styles/master.css">
<link rel="stylesheet" type="text/css" href="../../../../../_styles/document.css">
<link rel="stylesheet" type="text/css" href="../../../_styles/msvc.css">
<script type="text/javascript" src="../../../../../_scripts/master.js"></script>
<script type="text/javascript" src="../../../../../_scripts/document.js"></script>
<script type="text/javascript" src="../../../_scripts/msvc.js"></script>
</head>

<body>

<!--webbot bot="Include" U-Include="../../../_include/noscript.htm" TAG="BODY" startspan -->

<div class="NoScript" id="Banner">
  <div id="Links">
    <ul class="LinkList">
      <li class="LinkListItem"><a href="../../../../../index.htm"><span>Home</span></a> </li>
      <li class="LinkListItem"><a target="_self" href="../../../toc.htm"><span>Table of Contents</span></a> </li>
      <li class="LinkListItem"><a href="../../../../../about/index.htm"><span>About This Site</span></a> </li>
      <li class="LinkListItem"><a href="../../../../../new/index.htm"><span>What’s New?</span></a> </li>
      <li class="LinkListItem"><a href="../../../../../feedback/index.htm"><span>Feedback</span></a> </li>
      <li class="LinkListItem"><a href="../../../../../consult/index.htm"><span>Consult</span></a> </li>
    </ul>
  </div>
  <div id="Logo">
    <p>Geoff Chappell - Software Analyst </p>
  </div>
</div>

<!--webbot bot="Include" i-checksum="24274" endspan -->
<h1>Visual C++ Compiler Warning C4007 </h1>
<h2>Message Text </h2>
<pre class="output">&#39;<span class="placeholder">function</span>&#39; : must be &#39;<span class="placeholder">attribute</span>&#39;</pre>
<h2>Circumstances </h2>
<p>This warning condition occurs when a function is declared without specifying 
a calling convention but the name of the function is recognised by the compiler 
as requiring a calling convention that differs from the default. </p>
<p>Microsoft’s documentation cites the one example that “the function
<span class="function">main</span> must have the <span class="keyword">__cdecl</span> 
attribute.” The known cases for triggering warning C4007 from C1XX are several. 
They are perhaps readily induced from the one example, but it may be as well to 
enumerate them. </p>
<p>If a function is named either <span class="function">main</span> or
<span class="function">wmain</span> at file scope, then whatever the return type 
or arguments, if the declaration does not specify a calling convention, the compiler 
expects <span class="keyword">__cdecl</span>. If compiling with one of the several 
options that would ordinarily set some other calling convention by default, namely
<span class="switch">/Gc</span>, <span class="switch">
<a href="../../cl/options/g$r.htm">/Gr</a></span> or <span class="switch">
<a href="../../cl/options/g$z.htm">/Gz</a></span>, the compiler raises warning C4007 
and imposes <span class="keyword">__cdecl</span>. (The <span class="switch">/Gc</span> 
option, which sets the <span class="keyword">__pascal</span> calling convention 
as the default, is not supported by CL.EXE but can be passed to C1XX via
<span class="switch"><a href="../../cl/options/d1.htm">/d1</a></span>.) </p>
<p>The expected calling convention for a function named <span class="function">WinMain</span>,
<span class="function">DllMain</span> or <span class="function">wWinMain</span> 
at file scope is <span class="keyword">__stdcall</span>. Again, the return type 
and arguments are irrelevant, just the name. Warning C4007 follows if such a function 
is declared without a calling convention but is compiled without
<span class="switch">/Gz</span>. The compiler imposes <span class="keyword">__stdcall</span>.
</p>
<h2>Severity </h2>
<p>This is a level 3 warning, no matter that Microsoft’s documentation puts it at 
level 2. </p>
<h2>Example </h2>
<p>Microsoft’s own brief description of this warning suggests compiling </p>
<pre class="source">void main (void);</pre>
<p>with some such option as <span class="switch">/Gz</span> that will frustrate 
the requirement “the function <span class="function">main</span> must have the
<span class="keyword">__cdecl</span> attribute.” Do so, but with
<span class="switch">/W3</span> (or higher) to see the warning. </p>
<div class="Footer">
  <p class="Dates">This page was created on 27th January 2006 and was last modified 
  on 10th June 2009. </p>
  <!--webbot bot="Include" U-Include="../../../_include/c0609.htm" TAG="BODY" startspan -->

<p class="Copyright">Copyright © 2006-2009. Geoff Chappell. All rights reserved.
<a href="../../../../../about/terms.htm">Conditions apply</a>. </p>

<!--webbot bot="Include" i-checksum="62552" endspan -->
</div>

</body>

</html>
