<!doctype html>
<html lang="en">

<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<title>ETW_REALTIME_CONSUMER</title>
<link rel="stylesheet" type="text/css" href="../../../../../../../_styles/master.css">
<link rel="stylesheet" type="text/css" href="../../../../../../../_styles/document.css">
<link rel="stylesheet" type="text/css" href="../../../../_styles/km.css">
<script type="text/javascript" src="../../../../../../../_scripts/master.js"></script>
<script type="text/javascript" src="../../../../../../../_scripts/document.js"></script>
<script type="text/javascript" src="../../../../_scripts/km.js" defer></script>
</head>

<body>

<!--webbot bot="Include" U-Include="../../../../_include/noscript.htm" TAG="BODY" startspan -->

<div class="NoScript" id="Banner">
  <div id="Links">
    <ul class="LinkList">
      <li> 
      <ul class="PreferNoWrap">
        <li class="LinkListItem"><a href="../../../../../../../index.htm">Home</a> </li><!--
     --><li class="LinkListItem"><a target="_self" href="../../../../toc.htm">Table of Contents</a> </li><!--
     --><li class="LinkListItem"><a href="../../../../../../../about/index.htm">About This Site</a> </li>
      </ul>
      <ul class="PreferNoWrap">
        <li class="LinkListItem"><a href="../../../../../../../new/index.htm">What’s New?</a> </li><!--
     --><li class="LinkListItem"><a href="../../../../../../../feedback/index.htm">Feedback</a> </li><!--
     --><li class="LinkListItem"><a href="../../../../../../../consult/index.htm">Consult</a> </li>
      </ul>
      </li>
    </ul>
  </div>
  <div id="Logo">
    <p><span class="PreferNoWrap">Geoff Chappell -</span> <span class="PreferNoWrap">Software Analyst</span> </p>
  </div>
</div>

<!--webbot bot="Include" endspan i-checksum="48540" -->
<div class="Main">
  <h1>ETW_REALTIME_CONSUMER </h1>
  <p>The <span class="struct">ETW_REALTIME_CONSUMER</span> structure is the kernel’s 
  representation of a real-time event consumer that is connected to a logger. It 
  is a formal object, with handles and access control. The object type is named 
  EtwConsumer. Note that the kernel has no exported variable for this object type, 
  presumably because only the kernel is ever involved in interpreting a handle that 
  refers to such an object. </p>
  <h2>Documentation Status </h2>
  <p>The <span class="struct">ETW_REALTIME_CONSUMER</span> structure is not documented.
  </p>
  <h2>Layout </h2>
  <p>For a non-trivial structure that is plainly very much internal to the kernel, 
  the <span class="struct">ETW_REALTIME_CONSUMER</span> has been very stable, if 
  only since version 6.1 settled on making the structure into an object type. The 
  following changes of size are known. </p>
  <table class="Sizes">
    <colgroup>
      <col class="Version"><col span="2" class="Size">
    </colgroup>
    <thead>
      <tr>
        <th>Version </th>
        <th>Size (x86) </th>
        <th>Size (x64) </th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td>6.0 </td>
        <td>0x40 </td>
        <td>0x60 </td>
      </tr>
      <tr>
        <td>6.1 </td>
        <td>0x50 </td>
        <td>0x88 </td>
      </tr>
      <tr>
        <td>6.2 </td>
        <td>0x4C </td>
        <td>0x88 </td>
      </tr>
      <tr>
        <td>6.3 to 1511 </td>
        <td>0x54 </td>
        <td>0x98 </td>
      </tr>
      <tr>
        <td>1607 to 2004 </td>
        <td>0x58 </td>
        <td>0xA0 </td>
      </tr>
    </tbody>
  </table>
  <p>These sizes, and the offsets, types and names in the table below are from Microsoft’s 
  symbol files for the kernel starting with Windows 7. The implementation in version 
  6.0, predating the object type, is very different and type information seems not 
  to have made it into the public symbol files for Windows Vista, but there is evident 
  continuity. </p>
  <table class="Struct">
    <colgroup>
      <col class="Offset" span="2"><col class="Definition">
      <col class="Versions"><col class="Remarks">
    </colgroup>
    <thead>
      <tr>
        <th>Offset (x86) </th>
        <th>Offset (x64) </th>
        <th>Definition </th>
        <th>Versions </th>
        <th>Remarks </th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td>0x00 </td>
        <td>0x00 </td>
        <td>
        <pre class="source">LIST_ENTRY Links;</pre>
        </td>
        <td>6.0 and higher </td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>0x08 (6.0) </td>
        <td>0x10 (6.0) </td>
        <td>unknown <span class="type">HANDLE</span> to pipe </td>
        <td>6.0 only </td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>0x0C (6.0); <br>
        0x08 </td>
        <td>0x18 (6.0); <br>
        0x10 </td>
        <td>
        <pre class="source">HANDLE ProcessHandle;</pre>
        </td>
        <td>6.1 and higher </td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>0x10 (6.0) </td>
        <td>0x20 (6.0) </td>
        <td>unknown 32-bit sequence number as consumer ID </td>
        <td>6.0 only </td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>0x14 (6.0) </td>
        <td>0x24 (6.0) </td>
        <td>unknown 32-bit process ID </td>
        <td>6.0 only </td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>0x18 (6.0) </td>
        <td>0x28 (6.0) </td>
        <td>
        <pre class="source">ULONG BuffersLost;</pre>
        </td>
        <td>6.0 only </td>
        <td>next at 0x28 and 0x50 </td>
      </tr>
      <tr>
        <td>0x1C (6.0) </td>
        <td>0x2C (6.0) </td>
        <td>
        <pre class="source">BOOLEAN NewBuffersLost;</pre>
        </td>
        <td>6.0 only </td>
        <td>next at 0x35 and 0x5D </td>
      </tr>
      <tr>
        <td>0x0C </td>
        <td>0x18 </td>
        <td>
        <pre class="source"><a href="../ps/eprocess/index.htm">EPROCESS</a> *ProcessObject;</pre>
        </td>
        <td>6.1 and higher </td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>0x20 (6.0); <br>
        0x10 </td>
        <td>0x30 (6.0); <br>
        0x20 </td>
        <td>
        <pre class="source">PVOID NextNotDelivered;</pre>
        </td>
        <td>6.0 and higher </td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>0x24 (6.0); <br>
        0x14 </td>
        <td>0x38 (6.0); <br>
        0x28 </td>
        <td>
        <pre class="source">PVOID RealtimeConnectContext;</pre>
        </td>
        <td>6.0 and higher </td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>0x28 (6.0) </td>
        <td>0x40 (6.0) </td>
        <td>unknown <span class="struct">KEVENT</span> </td>
        <td>6.0 only </td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>0x18 </td>
        <td>0x30 </td>
        <td>
        <pre class="source">KEVENT *DisconnectEvent;</pre>
        </td>
        <td>6.1 and higher </td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>0x1C </td>
        <td>0x38 </td>
        <td>
        <pre class="source">KEVENT *DataAvailableEvent;</pre>
        </td>
        <td>6.1 and higher </td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>0x20 </td>
        <td>0x40 </td>
        <td>
        <pre class="source">ULONG *UserBufferCount;</pre>
        </td>
        <td>6.1 and higher </td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>0x24 </td>
        <td>0x48 </td>
        <td>
        <pre class="source">SINGLE_LIST_ENTRY *UserBufferListHead;</pre>
        </td>
        <td>6.1 and higher </td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>0x28 </td>
        <td>0x50 </td>
        <td>
        <pre class="source">ULONG BuffersLost;</pre>
        </td>
        <td>6.1 and higher </td>
        <td>previously at 0x18 and 0x28 </td>
      </tr>
      <tr>
        <td>0x38 (6.0); <br>
        0x2C </td>
        <td>0x58 (6.0); <br>
        0x54 </td>
        <td>
        <pre class="source">ULONG EmptyBuffersCount;</pre>
        </td>
        <td>6.0 and higher </td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td rowspan="2">0x30 </td>
        <td rowspan="2">0x58 </td>
        <td>
        <pre class="source">ULONG LoggerId;</pre>
        </td>
        <td>6.1 only </td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>
        <pre class="source">USHORT LoggerId;</pre>
        </td>
        <td>6.2 and higher </td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>0x3C (6.0); <br>
        0x34 (6.1) </td>
        <td>0x5C </td>
        <td>
        <pre class="source">BOOLEAN ShutDownRequested;</pre>
        </td>
        <td>6.0 to 6.1 <br>
        </td>
        <td>next in <span class="member">Flags</span> </td>
      </tr>
      <tr>
        <td>0x35 (6.1) </td>
        <td>0x5D (6.1) </td>
        <td>
        <pre class="source">BOOLEAN NewBuffersLost;</pre>
        </td>
        <td>6.1 only <br>
        </td>
        <td>previously at 0x1C and 0x2C; <br>
        next in <span class="member">Flags</span> </td>
      </tr>
      <tr>
        <td>0x36 (6.1) </td>
        <td>0x5E (6.1) </td>
        <td>
        <pre class="source">BOOLEAN Disconnected;</pre>
        </td>
        <td>6.1 only <br>
        </td>
        <td>next in <span class="member">Flags</span> </td>
      </tr>
      <tr>
        <td>0x32 </td>
        <td>0x5A </td>
        <td>
        <pre class="source">union {
    UCHAR Flags;
    struct {
        /*  bit fields, see below  */
    };
};</pre>
        </td>
        <td>6.2 and higher </td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>0x38 (6.1); <br>
        0x34 </td>
        <td>0x60 </td>
        <td>
        <pre class="source">RTL_BITMAP ReservedBufferSpaceBitMap;</pre>
        </td>
        <td>6.1 and higher </td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>0x40 (6.1); <br>
        0x3C </td>
        <td>0x70 </td>
        <td>
        <pre class="source">UCHAR *ReservedBufferSpace;</pre>
        </td>
        <td>6.1 and higher </td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>0x44 (6.1); <br>
        0x40 </td>
        <td>0x78 </td>
        <td>
        <pre class="source">ULONG ReservedBufferSpaceSize;</pre>
        </td>
        <td>6.1 and higher </td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>0x48 (6.1); <br>
        0x44 </td>
        <td>0x7C </td>
        <td>
        <pre class="source">ULONG UserPagesAllocated;</pre>
        </td>
        <td>6.1 and higher </td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>0x4C (6.1); <br>
        0x48 </td>
        <td>0x80 </td>
        <td>
        <pre class="source">ULONG UserPagesReused;</pre>
        </td>
        <td>6.1 and higher </td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>&nbsp;</td>
        <td>0x84 </td>
        <td>
        <pre class="source">BOOLEAN Wow;</pre>
        </td>
        <td>6.1 only </td>
        <td>next in <span class="member">Flags</span> </td>
      </tr>
      <tr>
        <td>0x4C </td>
        <td>0x88 </td>
        <td>
        <pre class="source">ULONG *EventsLostCount;</pre>
        </td>
        <td>6.3 and higher </td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>0x50 </td>
        <td>0x90 </td>
        <td>
        <pre class="source">ULONG *BuffersLostCount;</pre>
        </td>
        <td>6.3 and higher </td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>0x54 </td>
        <td>0x98 </td>
        <td>
        <pre class="source"><a href="etw_silodriverstate.htm">ETW_SILODRIVERSTATE</a> *SiloState;</pre>
        </td>
        <td>1607 and higher </td>
        <td>&nbsp;</td>
      </tr>
    </tbody>
  </table>
  <h3>Flags </h3>
  <p>Version 6.2 consolidated some one-byte booleans into <span class="type">UCHAR</span> 
  bit fields as <span class="member">Flags</span>, and added one: </p>
  <table class="Flags">
    <colgroup>
      <col class="Mask" span="2"><col class="Definition"><col class="Versions">
      <col class="Remarks">
    </colgroup>
    <thead>
      <tr>
        <th>Mask (x86) </th>
        <th>Mask (x64) </th>
        <th>Definition </th>
        <th>Versions </th>
        <th>Remarks </th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td>0x01 </td>
        <td>0x01 </td>
        <td>
        <pre class="source">UCHAR ShutDownRequest : 1;</pre>
        </td>
        <td>6.2 and higher </td>
        <td>previously <span class="type">BOOLEAN</span> at 0x34 and 0x5C </td>
      </tr>
      <tr>
        <td>0x02 </td>
        <td>0x02 </td>
        <td>
        <pre class="source">UCHAR NewBuffersLost : 1;</pre>
        </td>
        <td>6.2 and higher </td>
        <td>previously <span class="type">BOOLEAN</span> at 0x35 and 0x5D </td>
      </tr>
      <tr>
        <td>0x04 </td>
        <td>0x04 </td>
        <td>
        <pre class="source">UCHAR Disconnected : 1;</pre>
        </td>
        <td>6.2 and higher </td>
        <td>previously <span class="type">BOOLEAN</span> at 0x36 and 0x5E </td>
      </tr>
      <tr>
        <td>0x08 </td>
        <td>0x08 </td>
        <td>
        <pre class="source">UCHAR Notified : 1;</pre>
        </td>
        <td>6.2 and higher </td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>&nbsp;</td>
        <td>0x10 </td>
        <td>
        <pre class="source">UCHAR Wow : 1;</pre>
        </td>
        <td>6.2 and higher </td>
        <td>previously <span class="type">BOOLEAN</span> at 0x84 </td>
      </tr>
    </tbody>
  </table>
  <div class="Footer">
    <p class="Dates">This page was created on 26th
    <a href="../../../../../../../new/18/12.htm">December 2018</a> and was last 
    modified on 17th October 2022. </p>
    <!--webbot bot="Include" U-Include="../../../../_include/c1822.htm" TAG="BODY" startspan -->

<p class="Copyright">Copyright © 2018-2022. Geoff Chappell. All rights reserved. 
<a href="../../../../../../../about/terms.htm">Conditions apply</a>. </p>

<!--webbot bot="Include" endspan i-checksum="5181" -->
  </div>
</div>

</body>

</html>
