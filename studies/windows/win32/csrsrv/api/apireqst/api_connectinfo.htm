<html>

<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<title>CSR_API_CONNECTINFO</title>
<link rel="stylesheet" type="text/css" href="../../../../../../_styles/master.css">
<link rel="stylesheet" type="text/css" href="../../../../../../_styles/document.css">
<link rel="stylesheet" type="text/css" href="../../../_styles/win32.css">
<script type="text/javascript" src="../../../../../../_scripts/master.js"></script>
<script type="text/javascript" src="../../../../../../_scripts/document.js"></script>
<script type="text/javascript" src="../../../_scripts/win32.js"></script>
</head>

<body>

<!--webbot bot="Include" U-Include="../../../_include/noscript.htm" TAG="BODY" startspan -->

<div class="NoScript" id="Banner">
  <div id="Links">
    <ul class="LinkList">
      <li class="LinkListItem"><a href="../../../../../../index.htm"><span>Home</span></a> </li>
      <li class="LinkListItem"><a target="_self" href="../../../toc.htm"><span>Table of Contents</span></a> </li>
      <li class="LinkListItem"><a href="../../../../../../about/index.htm"><span>About This Site</span></a> </li>
      <li class="LinkListItem"><a href="../../../../../../new/index.htm"><span>What’s New?</span></a> </li>
      <li class="LinkListItem"><a href="../../../../../../feedback/index.htm"><span>Feedback</span></a> </li>
      <li class="LinkListItem"><a href="../../../../../../consult/index.htm"><span>Consult</span></a> </li>
    </ul>
  </div>
  <div id="Logo">
    <p>Geoff Chappell, Software Analyst </p>
  </div>
</div>

<!--webbot bot="Include" endspan i-checksum="54033" -->
<h1>CSR_API_CONNECTINFO </h1>
<p>The <span class="struct">CSR_API_CONNECTINFO</span> structure is the connection 
information that a client process of the CSRSS.EXE server supplies to the
<span class="function">NtConnectPort</span> function when hoping to connect to the 
server. CSRSRV.DLL in the CSRSS.EXE process receives this data as the
<span class="member">ConnectionRequest</span> in a <span class="struct">
<a href="api_msg.htm">CSR_API_MSG</a></span> whose <span class="struct">PORT_MESSAGE</span> 
header has <span class="constant">LPC_CONNECTION_REQUEST</span> (0x000A) as its
<span class="member">Type</span>. </p>
<h2>Documentation Status </h2>
<p>The <span class="struct">CSR_API_CONNECTINFO</span> structure is not documented. 
Neither is Microsoft known to have disclosed a C-language definition in any header 
from any publicly available kit for any sort of software development. Type information 
for the <span class="struct">CSR_API_CONNECTINFO</span> is in public symbol files 
for CSRSS.EXE in Windows Vista only. Earlier type information is known in a statically 
linked library, named GDISRVL.LIB, which Microsoft published with the Device Driver 
Kit (DDK) for Windows NT 3.51. </p>
<h2>Variability </h2>
<p>The following changes of size are known: </p>
<table class="Sizes">
  <colgroup>
    <col class="Version"><col class="Size" span="2">
  </colgroup>
  <tr>
    <th>Version </th>
    <th>Size (x86) </th>
    <th>Size (x64) </th>
  </tr>
  <tr>
    <td>3.10 to 5.0 </td>
    <td>0x28 </td>
    <td>&nbsp;</td>
  </tr>
  <tr>
    <td>5.1 </td>
    <td>0x2C </td>
    <td>&nbsp;</td>
  </tr>
  <tr>
    <td>5.2 </td>
    <td>0x24 </td>
    <td>0x38 </td>
  </tr>
  <tr>
    <td>6.0 to 6.1 </td>
    <td>0x20 </td>
    <td>0x30 </td>
  </tr>
  <tr>
    <td>6.2 to 10.0 </td>
    <td>0x1C </td>
    <td>0x30 </td>
  </tr>
</table>
<h2>Layout </h2>
<p>These sizes and the names and types in the table that follows are from type information 
in public symbol files (or such as would ordinarily be in public symbol files) for 
versions 3.51 and 6.0. What’s known of Microsoft’s names and types for other versions 
is something of a guess, being inferred from what use CSRSRV is seen to make of 
the structure. Where use of a member corresponds closely with that of a version 
for which Microsoft’s symbols are available, it seems reasonable to suppose continuity. 
Some use, however, has no correspondence, the code having changed too much. Even 
where the use hasn’t changed, tracking it down exhaustively would be difficult, 
if not impossible, even with source code. </p>
<table class="Struct">
  <colgroup>
    <col class="Offset" span="2"><col class="Definition">
  </colgroup>
  <tr>
    <th>Offset (x86) </th>
    <th>Offset (x64) </th>
    <th>Definition </th>
    <th>Versions </th>
    <th>Remarks </th>
  </tr>
  <tr>
    <td>0x00 (3.10 to 5.1) </td>
    <td>&nbsp;</td>
    <td>
    <pre class="source">ULONG ExpectedVersion;</pre>
    </td>
    <td>3.10 to 5.1 </td>
    <td>input </td>
  </tr>
  <tr>
    <td>0x04 (3.10 to 5.1) </td>
    <td>&nbsp;</td>
    <td>
    <pre class="source">ULONG CurrentVersion;</pre>
    </td>
    <td>3.10 to 5.1 </td>
    <td>&nbsp;</td>
  </tr>
  <tr>
    <td>0x08 (3.10 to 5.1); <br>
    0x00 (5.2 to 6.1) </td>
    <td>0x00 (before 6.2) </td>
    <td>
    <pre class="source">HANDLE ObjectDirectory;</pre>
    </td>
    <td>3.10 to 6.1 </td>
    <td>output </td>
  </tr>
  <tr>
    <td>0x0C (3.10 to 5.1); <br>
    0x04 (5.2 to 6.1); <br>
    0x00 </td>
    <td>0x08 (before 6.2); <br>
    0x00 </td>
    <td>
    <pre class="source">PVOID SharedSectionBase;</pre>
    </td>
    <td>all </td>
    <td>output </td>
  </tr>
  <tr>
    <td>0x10 (3.10 to 5.1); <br>
    0x08 (5.2 to 6.1); <br>
    0x04 </td>
    <td>0x10 (before 6.2); <br>
    0x08 </td>
    <td>
    <pre class="source">PVOID SharedStaticServerData;</pre>
    </td>
    <td>all </td>
    <td>output </td>
  </tr>
  <tr>
    <td>0x14 (3.10 to 5.1); <br>
    0x0C (5.2) </td>
    <td>0x18 (late 5.2) </td>
    <td>
    <pre class="source">PVOID SharedSectionHeap;</pre>
    </td>
    <td>3.10 to 5.2 </td>
    <td>output </td>
  </tr>
  <tr>
    <td>0x18 (3.10 to 5.1); <br>
    0x10 (5.2); <br>
    0x0C (6.0 to 6.1) </td>
    <td>0x20 (late5.2); <br>
    0x18 (6.0 to 6.1) <br>
    </td>
    <td>
    <pre class="source">ULONG DebugFlags;</pre>
    </td>
    <td>3.10 to 6.1 </td>
    <td>&nbsp;</td>
  </tr>
  <tr>
    <td>0x1C (3.10 to 5.1); <br>
    0x14 (5.2); <br>
    0x10 (6.0 to 6.1) </td>
    <td>0x24 (late 5.2); <br>
    0x1C &nbsp;(6.0 to 6.1) </td>
    <td>
    <pre class="source">ULONG SizeOfPebData;</pre>
    </td>
    <td>3.10 to 6.1 </td>
    <td>&nbsp;</td>
  </tr>
  <tr>
    <td>0x20 (3.10 to 5.1); <br>
    0x18 (5.2); <br>
    0x14 (6.0 to 6.1) </td>
    <td>0x28 (late 5.2); <br>
    0x20 (6.0 to 6.1) </td>
    <td>
    <pre class="source">ULONG SizeOfTebData;</pre>
    </td>
    <td>3.10 to 6.1 </td>
    <td>&nbsp;</td>
  </tr>
  <tr>
    <td>0x24 (3.10 to 5.1); <br>
    0x1C (5.2); <br>
    0x18 (6.0 to 6.1) </td>
    <td>0x2C (late 5.2); <br>
    0x24 (6.0 to 6.1) </td>
    <td>
    <pre class="source">ULONG NumberOfServerDllNames;</pre>
    </td>
    <td>3.10 to 6.1 </td>
    <td>&nbsp;</td>
  </tr>
  <tr>
    <td>0x28 (5.1); <br>
    0x20 (5.2); <br>
    0x1C (6.0 to 6.1); <br>
    0x08 </td>
    <td>0x30 (late 5.2); <br>
    0x28 (6.0 to 6.1); <br>
    0x10 </td>
    <td>
    <pre class="source">PVOID ServerProcessId;</pre>
    </td>
    <td>5.1 and higher </td>
    <td>output </td>
  </tr>
  <tr>
    <td>0x0C </td>
    <td>0x18 </td>
    <td>unaccounted 4 or 8 bytes </td>
    <td>6.2 and higher </td>
    <td>&nbsp;</td>
  </tr>
  <tr>
    <td>0x10 </td>
    <td>0x20 </td>
    <td>unknown dword </td>
    <td>6.2 and higher </td>
    <td>input </td>
  </tr>
  <tr>
    <td>0x14 </td>
    <td>0x24 </td>
    <td>unknown dword </td>
    <td>6.2 and higher </td>
    <td>input <br>
    output </td>
  </tr>
  <tr>
    <td>0x18 </td>
    <td>0x28 </td>
    <td>unknown 4 or 8 bytes </td>
    <td>6.2 and higher </td>
    <td>input </td>
  </tr>
</table>
<div class="Footer">
  <p class="Dates">This page was created on 21st
  <a href="../../../../../../new/19/06.htm">June 2019</a> and was last modified 
  on 23rd June 2019. </p>
  <!--webbot bot="Include" U-Include="../../../_include/c19.htm" TAG="BODY" startspan -->

<p class="Copyright">Copyright © 2019. Geoff Chappell. All rights reserved. 
<a href="../../../../../../about/terms.htm">Conditions apply</a>. </p>

<!--webbot bot="Include" endspan i-checksum="62933" -->
</div>

</body>

</html>
