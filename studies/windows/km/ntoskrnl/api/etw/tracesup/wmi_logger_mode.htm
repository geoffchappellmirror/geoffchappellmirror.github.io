<html>

<head>
<title>WMI_LOGGER_MODE</title>
<link rel="stylesheet" type="text/css" href="../../../../../../../_styles/master.css">
<link rel="stylesheet" type="text/css" href="../../../../../../../_styles/document.css">
<link rel="stylesheet" type="text/css" href="../../../../_styles/km.css">
<script type="text/javascript" src="../../../../../../../_scripts/master.js"></script>
<script type="text/javascript" src="../../../../../../../_scripts/document.js"></script>
<script type="text/javascript" src="../../../../_scripts/km.js"></script>
</head>

<body>

<!--webbot bot="Include" U-Include="../../../../_include/noscript.htm" TAG="BODY" startspan -->

<div class="NoScript" id="Banner">
  <div id="Links">
    <ul class="LinkList">
      <li> 
      <ul class="PreferNoWrap">
        <li class="LinkListItem"><a href="../../../../../../../index.htm">Home</a> </li><!--
     --><li class="LinkListItem"><a target="_self" href="../../../../toc.htm">Table of Contents</a> </li><!--
     --><li class="LinkListItem"><a href="../../../../../../../about/index.htm">About This Site</a> </li>
      </ul>
      <ul class="PreferNoWrap">
        <li class="LinkListItem"><a href="../../../../../../../new/index.htm">What’s New?</a> </li><!--
     --><li class="LinkListItem"><a href="../../../../../../../feedback/index.htm">Feedback</a> </li><!--
     --><li class="LinkListItem"><a href="../../../../../../../consult/index.htm">Consult</a> </li>
      </ul>
      </li>
    </ul>
  </div>
  <div id="Logo">
    <p><span class="PreferNoWrap">Geoff Chappell -</span> <span class="PreferNoWrap">Software Analyst</span> </p>
  </div>
</div>

<!--webbot bot="Include" endspan i-checksum="48540" -->
<h1>WMI_LOGGER_MODE </h1>
<p>Public symbol files for the kernel in Windows XP SP3 and Windows Server 
2003 SP2 show that the <span class="member">LoggerMode</span> in the
<span class="struct"><a href="wmi_logger_context/index.htm">WMI_LOGGER_CONTEXT</a></span> 
was once defined in union with a <span class="struct">WMI_LOGGER_MODE</span> structure 
of <span class="type">ULONG</span> bit fields: </p>
<table class="Bits">
  <tr>
    <th>Mask </th>
    <th>Definition </th>
    <th>Versions </th>
  </tr>
  <tr>
    <td>0x00000001</td>
    <td>
    <pre class="source">ULONG SequentialFile : 1;</pre>
    </td>
    <td>5.0 to 5.2 </td>
  </tr>
  <tr>
    <td>0x00000002 </td>
    <td>
    <pre class="source">ULONG CircularFile : 1;</pre>
    </td>
    <td>5.0 to 5.2 </td>
  </tr>
  <tr>
    <td>0x00000004 </td>
    <td>
    <pre class="source">ULONG AppendFile : 1;</pre>
    </td>
    <td>5.1 to 5.2 </td>
  </tr>
  <tr>
    <td rowspan="2">&nbsp;</td>
    <td>
    <pre class="source">ULONG Unused1 : 6;</pre>
    </td>
    <td>5.0 only </td>
  </tr>
  <tr>
    <td>
    <pre class="source">ULONG Unused1 : 5;</pre>
    </td>
    <td>5.1 to 5.2 </td>
  </tr>
  <tr>
    <td>0x00000100 </td>
    <td>
    <pre class="source">ULONG RealTime : 1;</pre>
    </td>
    <td>5.0 to 5.2 </td>
  </tr>
  <tr>
    <td>0x00000200 </td>
    <td>
    <pre class="source">ULONG DelayOpenFile : 1;</pre>
    </td>
    <td>5.0 to 5.2 </td>
  </tr>
  <tr>
    <td>0x00000400 </td>
    <td>
    <pre class="source">ULONG BufferOnly : 1;</pre>
    </td>
    <td>5.0 to 5.2 </td>
  </tr>
  <tr>
    <td>0x00000800</td>
    <td>
    <pre class="source">ULONG PrivateLogger : 1;</pre>
    </td>
    <td>5.0 to 5.2 </td>
  </tr>
  <tr>
    <td>0x00001000 </td>
    <td>
    <pre class="source">ULONG AddHeader : 1;</pre>
    </td>
    <td>5.0 to 5.2 </td>
  </tr>
  <tr>
    <td>0x00002000 </td>
    <td>
    <pre class="source">ULONG UseExisting : 1;</pre>
    </td>
    <td>5.1 to 5.2 </td>
  </tr>
  <tr>
    <td>0x00004000 </td>
    <td>
    <pre class="source">ULONG UseGlobalSequence : 1;</pre>
    </td>
    <td>5.1 to 5.2 </td>
  </tr>
  <tr>
    <td>0x00008000 </td>
    <td>
    <pre class="source">ULONG UseLocalSequence : 1;</pre>
    </td>
    <td>5.1 to 5.2 </td>
  </tr>
  <tr>
    <td>&nbsp;</td>
    <td>
    <pre class="source">ULONG Unused2 : 16;</pre>
    </td>
    <td>5.1 to 5.2 </td>
  </tr>
</table>
<p>The symbol files show that this stopped for version 6.0. When it began is an 
open question. That it was established for all builds of versions 5.1 and 5.2 must 
be almost certain. The suggestion is strong that it dates from version 5.0. See 
especially that <span class="member">PrivateLogger</span> is defined for the kernel’s 
symbol files even though it is not known to the kernel. It is, however, meaningful 
to the user-mode implementation right from the start. Though the two implementations, kernel-mode and 
user-mode, soon diverged, their <span class="struct">WMI_LOGGER_CONTEXT</span> structures 
very plainly had a common origin for version 5.0, and it is here thought that 
they had the
<span class="struct">WMI_LOGGER_MODE</span> in common too. </p>
<p>On the other hand, the <span class="struct">WMI_LOGGER_MODE</span> can’t have 
been more than peripheral to the programming even in the versions for which its 
definition is certain. See in particular the uneven definition of flags for 
version 5.1: <span class="constant">EVENT_TRACE_FILE_MODE_APPEND</span> becomes
<span class="member">AppendFile</span>, presumably narrowing what had been left 
as <span class="member">Unused1</span>, but no bit field is defined for what was 
then the similarly new <span class="constant">EVENT_TRACE_FILE_MODE_NEWFILE</span>. </p>
<h2>Kernel Mode Logger Modes </h2>
<p>It is perhaps as well to collect here the various bits that represent the wide 
variety of possible logger modes, as kept in the <span class="member">LoggerMode</span> 
member of the kernel-mode <span class="struct">WMI_LOGGER_CONTEXT</span>. Some are documented, and are defined as macros in EVNTRACE.H, but Microsoft’s 
names for some are known only from the NTWMI.H header which Microsoft published 
in the Enterprise edition of the Windows Driver Kit (WDK) for Windows 10 version 
1511. The reckoning of which flags 
are supported in which versions is in preparation: do not rely on it. </p>
<table>
  <tr>
    <th>Value </th>
    <th>Name </th>
    <th>Versions </th>
    <th>Kernel-Mode Constraints </th>
  </tr>
  <tr>
    <td>0x00000001 </td>
    <td><span class="constant">EVENT_TRACE_FILE_MODE_SEQUENTIAL</span> </td>
    <td>5.0 and higher </td>
    <td>invalid with <span class="constant">EVENT_TRACE_FILE_MODE_CIRCULAR</span> </td>
  </tr>
  <tr>
    <td rowspan="2">0x00000002 </td>
    <td rowspan="2"><span class="constant">EVENT_TRACE_FILE_MODE_CIRCULAR</span> </td>
    <td>5.0 and higher </td>
    <td>invalid with <span class="constant">EVENT_TRACE_FILE_MODE_SEQUENTIAL</span> </td>
  </tr>
  <tr>
    <td>5.1 and higher </td>
    <td>invalid with <span class="constant">EVENT_TRACE_FILE_MODE_APPEND</span> </td>
  </tr>
  <tr>
    <td>0x00000004 </td>
    <td><span class="constant">EVENT_TRACE_FILE_MODE_APPEND</span> </td>
    <td>5.1 and higher </td>
    <td>invalid with <span class="constant">EVENT_TRACE_FILE_MODE_CIRCULAR</span> </td>
  </tr>
  <tr>
    <td>0x00000008 </td>
    <td><span class="constant">EVENT_TRACE_FILE_MODE_NEWFILE</span> </td>
    <td>5.1 and higher </td>
    <td>&nbsp;</td>
  </tr>
  <tr>
    <td rowspan="2">0x00000010 </td>
    <td>unknown </td>
    <td>5.2 only </td>
    <td>but not defined for 5.2 DDK </td>
  </tr>
  <tr>
    <td><span class="constant">EVENT_TRACE_USE_MS_FLUSH_TIMER</span> </td>
    <td>6.1 and higher </td>
    <td>&nbsp;</td>
  </tr>
  <tr>
    <td>0x00000020 </td>
    <td><span class="constant">EVENT_TRACE_FILE_MODE_PREALLOCATE</span> </td>
    <td>5.1 and higher </td>
    <td>&nbsp;</td>
  </tr>
  <tr>
    <td>0x00000040 </td>
    <td><span class="constant">EVENT_TRACE_NONSTOPPABLE_MODE</span> </td>
    <td>6.0 and higher </td>
    <td>&nbsp;</td>
  </tr>
  <tr>
    <td>0x00000080 </td>
    <td><span class="constant">EVENT_TRACE_SECURE_MODE</span> </td>
    <td>6.0 and higher </td>
    <td>&nbsp;</td>
  </tr>
  <tr>
    <td>0x00000100 </td>
    <td><span class="constant">EVENT_TRACE_REAL_TIME_MODE</span> </td>
    <td>5.0 and higher </td>
    <td>&nbsp;</td>
  </tr>
  <tr>
    <td rowspan="3">0x00000200 </td>
    <td rowspan="3"><span class="constant">EVENT_TRACE_DELAY_OPEN_FILE_MODE</span> </td>
    <td>5.0 only </td>
    <td>requires <span class="member">LogFileName</span> </td>
  </tr>
  <tr>
    <td>5.1 and higher </td>
    <td>&nbsp;</td>
  </tr>
  <tr>
    <td>6.1 and higher </td>
    <td>ignored (but see note) </td>
  </tr>
  <tr>
    <td>0x00000400 </td>
    <td><span class="constant">EVENT_TRACE_BUFFERING_MODE</span> </td>
    <td>5.0 and higher </td>
    <td>&nbsp;</td>
  </tr>
  <tr>
    <td>0x00000800 </td>
    <td><span class="constant">EVENT_TRACE_PRIVATE_LOGGER_MODE</span> </td>
    <td></td>
    <td>user-mode only </td>
  </tr>
  <tr>
    <td rowspan="2">0x00001000 </td>
    <td rowspan="2"><span class="constant">EVENT_TRACE_ADD_HEADER_MODE</span> </td>
    <td>5.0 only </td>
    <td>&nbsp;</td>
  </tr>
  <tr>
    <td>6.1 and higher </td>
    <td>mostly ignored </td>
  </tr>
  <tr>
    <td>0x00002000 </td>
    <td><span class="constant">EVENT_TRACE_USE_KBYTES_FOR_SIZE</span> </td>
    <td>5.2 and higher </td>
    <td>but not defined for 5.2 DDK </td>
  </tr>
  <tr>
    <td>0x00004000 </td>
    <td><span class="constant">EVENT_TRACE_USE_GLOBAL_SEQUENCE</span> </td>
    <td>5.1 and higher </td>
    <td>invalid with <span class="constant">EVENT_TRACE_USE_LOCAL_SEQUENCE</span> </td>
  </tr>
  <tr>
    <td>0x00008000 </td>
    <td><span class="constant">EVENT_TRACE_USE_LOCAL_SEQUENCE</span> </td>
    <td>5.1 and higher </td>
    <td>invalid with <span class="constant">EVENT_TRACE_USE_GLOBAL_SEQUENCE</span> </td>
  </tr>
  <tr>
    <td>0x00010000 </td>
    <td><span class="constant">EVENT_TRACE_RELOG_MODE</span> </td>
    <td>&nbsp;</td>
    <td>user-mode only </td>
  </tr>
  <tr>
    <td>0x00020000 </td>
    <td><span class="constant">EVENT_TRACE_PRIVATE_IN_PROC</span> </td>
    <td>&nbsp;</td>
    <td>user-mode only </td>
  </tr>
  <tr>
    <td>0x00040000 </td>
    <td><span class="constant">EVENT_TRACE_BUFFER_INTERFACE_MODE</span> </td>
    <td>6.1 and higher </td>
    <td>&nbsp;</td>
  </tr>
  <tr>
    <td>0x00080000 </td>
    <td><span class="constant">EVENT_TRACE_KD_FILTER_MODE</span> </td>
    <td>5.1 and higher </td>
    <td>but not defined for 5.1 DDK </td>
  </tr>
  <tr>
    <td rowspan="2">0x00100000 </td>
    <td rowspan="2"><span class="constant">EVENT_TRACE_REALTIME_RELOG_MODE</span> </td>
    <td>6.0 and higher </td>
    <td>&nbsp;</td>
  </tr>
  <tr>
    <td>6.1 and higher </td>
    <td>mostly ignored </td>
  </tr>
  <tr>
    <td>0x00200000 </td>
    <td><span class="constant">EVENT_TRACE_LOST_EVENTS_DEBUG_MODE</span> </td>
    <td>6.2 and higher </td>
    <td>&nbsp;</td>
  </tr>
  <tr>
    <td>0x00400000 </td>
    <td><span class="constant">EVENT_TRACE_STOP_ON_HYBRID_SHUTDOWN</span> </td>
    <td>6.2 and higher </td>
    <td>&nbsp;</td>
  </tr>
  <tr>
    <td>0x00800000 </td>
    <td><span class="constant">EVENT_TRACE_PERSIST_ON_HYBRID_SHUTDOWN</span>
    </td>
    <td>6.2 and higher </td>
    <td>&nbsp;</td>
  </tr>
  <tr>
    <td>0x01000000 </td>
    <td><span class="constant">EVENT_TRACE_USE_PAGED_MEMORY</span> </td>
    <td>5.1 and higher </td>
    <td>&nbsp;</td>
  </tr>
  <tr>
    <td>0x02000000 </td>
    <td><span class="constant">EVENT_TRACE_SYSTEM_LOGGER_MODE</span> </td>
    <td>6.2 and higher </td>
    <td>&nbsp;</td>
  </tr>
  <tr>
    <td>0x04000000 </td>
    <td><span class="constant">EVENT_TRACE_COMPRESSED_MODE</span> </td>
    <td>6.2 and higher </td>
    <td>invalid </td>
  </tr>
  <tr>
    <td>0x08000000 </td>
    <td><span class="constant">EVENT_TRACE_INDEPENDENT_SESSION_MODE</span> </td>
    <td>6.3 and higher </td>
    <td>&nbsp;</td>
  </tr>
  <tr>
    <td>0x10000000 </td>
    <td><span class="constant">EVENT_TRACE_NO_PER_PROCESSOR_BUFFERING</span>
    </td>
    <td>6.1 and higher </td>
    <td>&nbsp;</td>
  </tr>
  <tr>
    <td>0x20000000 </td>
    <td><span class="constant">EVENT_TRACE_BLOCKING_MODE</span> </td>
    <td>&nbsp;</td>
    <td>&nbsp;</td>
  </tr>
  <tr>
    <td>0x40000000 </td>
    <td>apparently unused </td>
    <td>&nbsp;</td>
    <td>&nbsp;</td>
  </tr>
  <tr>
    <td>0x80000000 </td>
    <td><span class="constant">EVENT_TRACE_ADDTO_TRIAGE_DUMP</span> </td>
    <td>6.2 and higher </td>
    <td>&nbsp;</td>
  </tr>
</table>
<p>Very many combinations of these bits are invalid. Some bits are not known to 
the kernel but are instead vital to the separate NTDLL implementation that lets 
user-mode processes do their own event tracing. </p>
<div class="Footer">
  <p class="Dates">This page was created on 25th November 2018 from material first 
  published on 25th <a href="../../../../../../../new/16/11.htm">November 2016</a>. 
  It was last modified on 31st <a href="../../../../../../../new/18/12.htm">December 
  2018</a>. </p>
  <!--webbot bot="Include" U-Include="../../../../_include/c1618.htm" TAG="BODY" startspan -->

<p class="Copyright">Copyright © 2016-2018. Geoff Chappell. All rights reserved. 
<a href="../../../../../../../about/terms.htm">Conditions apply</a>. </p>

<!--webbot bot="Include" endspan i-checksum="5013" -->
</div>

</body>

</html>
